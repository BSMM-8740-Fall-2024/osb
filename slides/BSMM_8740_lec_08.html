<!DOCTYPE html>
<html lang="en"><head>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-html/tabby.min.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-html.min.css" rel="stylesheet" data-mode="light">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.5.54">

  <meta name="author" content="L.L. Odette">
  <title>BSMM-8740 - Fall 2024 – Causality Part 2</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; font-weight: bold; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="../site_libs/revealjs/dist/theme/quarto.css">
  <link href="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">

  .callout {
    margin-top: 1em;
    margin-bottom: 1em;  
    border-radius: .25rem;
  }

  .callout.callout-style-simple { 
    padding: 0em 0.5em;
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
    display: flex;
  }

  .callout.callout-style-default {
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
  }

  .callout .callout-body-container {
    flex-grow: 1;
  }

  .callout.callout-style-simple .callout-body {
    font-size: 1rem;
    font-weight: 400;
  }

  .callout.callout-style-default .callout-body {
    font-size: 0.9rem;
    font-weight: 400;
  }

  .callout.callout-titled.callout-style-simple .callout-body {
    margin-top: 0.2em;
  }

  .callout:not(.callout-titled) .callout-body {
      display: flex;
  }

  .callout:not(.no-icon).callout-titled.callout-style-simple .callout-content {
    padding-left: 1.6em;
  }

  .callout.callout-titled .callout-header {
    padding-top: 0.2em;
    margin-bottom: -0.2em;
  }

  .callout.callout-titled .callout-title  p {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
  }
    
  .callout.callout-titled.callout-style-simple .callout-content  p {
    margin-top: 0;
  }

  .callout.callout-titled.callout-style-default .callout-content  p {
    margin-top: 0.7em;
  }

  .callout.callout-style-simple div.callout-title {
    border-bottom: none;
    font-size: .9rem;
    font-weight: 600;
    opacity: 75%;
  }

  .callout.callout-style-default  div.callout-title {
    border-bottom: none;
    font-weight: 600;
    opacity: 85%;
    font-size: 0.9rem;
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-default div.callout-content {
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-simple .callout-icon::before {
    height: 1rem;
    width: 1rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 1rem 1rem;
  }

  .callout.callout-style-default .callout-icon::before {
    height: 0.9rem;
    width: 0.9rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 0.9rem 0.9rem;
  }

  .callout-title {
    display: flex
  }
    
  .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  .callout.no-icon::before {
    display: none !important;
  }

  .callout.callout-titled .callout-body > .callout-content > :last-child {
    padding-bottom: 0.5rem;
    margin-bottom: 0;
  }

  .callout.callout-titled .callout-icon::before {
    margin-top: .5rem;
    padding-right: .5rem;
  }

  .callout:not(.callout-titled) .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  /* Callout Types */

  div.callout-note {
    border-left-color: #4582ec !important;
  }

  div.callout-note .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEU0lEQVRYCcVXTWhcVRQ+586kSUMMxkyaElstCto2SIhitS5Ek8xUKV2poatCcVHtUlFQk8mbaaziwpWgglJwVaquitBOfhQXFlqlzSJpFSpIYyXNjBNiTCck7x2/8/LeNDOZxDuEkgOXe++553zfefee+/OYLOXFk3+1LLrRdiO81yNqZ6K9cG0P3MeFaMIQjXssE8Z1JzLO9ls20MBZX7oG8w9GxB0goaPrW5aNMp1yOZIa7Wv6o2ykpLtmAPs/vrG14Z+6d4jpbSKuhdcSyq9wGMPXjonwmESXrriLzFGOdDBLB8Y6MNYBu0dRokSygMA/mrun8MGFN3behm6VVAwg4WR3i6FvYK1T7MHo9BK7ydH+1uurECoouk5MPRyVSBrBHMYwVobG2aOXM07sWrn5qgB60rc6mcwIDJtQrnrEr44kmy+UO9r0u9O5/YbkS9juQckLed3DyW2XV/qWBBB3ptvI8EUY3I9p/67OW+g967TNr3Sotn3IuVlfMLVnsBwH4fsnebJvyGm5GeIUA3jljERmrv49SizPYuq+z7c2H/jlGC+Ghhupn/hcapqmcudB9jwJ/3jvnvu6vu5lVzF1fXyZuZZ7U8nRmVzytvT+H3kilYvH09mLWrQdwFSsFEsxFVs5fK7A0g8gMZjbif4ACpKbjv7gNGaD8bUrlk8x+KRflttr22JEMRUbTUwwDQScyzPgedQHZT0xnx7ujw2jfVfExwYHwOsDTjLdJ2ebmeQIlJ7neo41s/DrsL3kl+W2lWvAga0tR3zueGr6GL78M3ifH0rGXrBC2aAR8uYcIA5gwV8zIE8onoh8u0Fca/ciF7j1uOzEnqcIm59sEXoGc0+z6+H45V1CvAvHcD7THztu669cnp+L0okAeIc6zjbM/24LgGM1gZk7jnRu1aQWoU9sfUOuhrmtaPIO3YY1KLLWZaEO5TKUbMY5zx8W9UJ6elpLwKXbsaZ4EFl7B4bMtDv0iRipKoDQT2sNQI9b1utXFdYisi+wzZ/ri/1m7QfDgEuvgUUEIJPq3DhX/5DWNqIXDOweC2wvIR90Oq3lDpdMIgD2r0dXvGdsEW5H6x6HLRJYU7C69VefO1x8Gde1ZFSJLfWS1jbCnhtOPxmpfv2LXOA2Xk2tvnwKKPFuZ/oRmwBwqRQDcKNeVQkYcOjtWVBuM/JuYw5b6isojIkYxyYAFn5K7ZBF10fea52y8QltAg6jnMqNHFBmGkQ1j+U43HMi2xMar1Nv0zGsf1s8nUsmUtPOOrbFIR8bHFDMB5zL13Gmr/kGlCkUzedTzzmzsaJXhYawnA3UmARpiYj5ooJZiUoxFRtK3X6pgNPv+IZVPcnwbOl6f+aBaO1CNvPW9n9LmCp01nuSaTRF2YxHqZ8DYQT6WsXT+RD6eUztwYLZ8rM+rcPxamv1VQzFUkzFXvkiVrySGQgJNvXHJAxiU3/NwiC03rSf05VBaPtu/Z7/B8Yn/w7eguloAAAAAElFTkSuQmCC');
  }

  div.callout-note.callout-style-default .callout-title {
    background-color: #dae6fb
  }

  div.callout-important {
    border-left-color: #d9534f !important;
  }

  div.callout-important .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEKklEQVRYCcVXTWhcVRS+575MJym48A+hSRFr00ySRQhURRfd2HYjk2SSTokuBCkU2o0LoSKKraKIBTcuFCoidGFD08nkBzdREbpQ1EDNIv8qSGMFUboImMSZd4/f9zJv8ibJMC8xJQfO3HPPPef7zrvvvnvviIkpC9nsw0UttFunbUhpFzFtarSd6WJkStVMw5xyVqYTvkwfzuf/5FgtkVoB0729j1rjXwThS7Vio+Mo6DNnvLfahoZ+i/o32lULuJ3NNiz7q6+pyAUkJaFF6JwaM2lUJlV0MlnQn5aTRbEu0SEqHUa0A4AdiGuB1kFXRfVyg5d87+Dg4DL6m2TLAub60ilj7A1Ec4odSAc8X95sHh7+ZRPCFo6Fnp7HfU/fBng/hi10CjCnWnJjsxvDNxWw0NfV6Rv5GgP3I3jGWXumdTD/3cbEOP2ZbOZp69yniG3FQ9z1jD7bnBu9Fc2tKGC2q+uAJOQHBDRiZX1x36o7fWBs7J9ownbtO+n0/qWkvW7UPIfc37WgT6ZGR++EOJyeQDSb9UB+DZ1G6DdLDzyS+b/kBCYGsYgJbSQHuThGKRcw5xdeQf8YdNHsc6ePXrlSYMBuSIAFTGAtQo+VuALo4BX83N190NWZWbynBjhOHsmNfFWLeL6v+ynsA58zDvvAC8j5PkbOcXCMg2PZFk3q8MjI7WAG/Dp9AwP7jdGBOOQkAvlFUB+irtm16I1Zw9YBcpGTGXYmk3kQIC/Cds55l+iMI3jqhjAuaoe+am2Jw5GT3Nbz3CkE12NavmzN5+erJW7046n/CH1RO/RVa8lBLozXk9uqykkGAyRXLWlLv5jyp4RFsG5vGVzpDLnIjTWgnRy2Rr+tDKvRc7Y8AyZq10jj8DqXdnIRNtFZb+t/ZRtXcDiVnzpqx8mPcDWxgARUqx0W1QB9MeUZiNrV4qP+Ehc+BpNgATsTX8ozYKL2NtFYAHc84fG7ndxUPr+AR/iQSns7uSUufAymwDOb2+NjK27lEFocm/EE2WpyIy/Hi66MWuMKJn8RvxIcj87IM5Vh9663ziW36kR0HNenXuxmfaD8JC7tfKbrhFr7LiZCrMjrzTeGx+PmkosrkNzW94ObzwocJ7A1HokLolY+AvkTiD/q1H0cN48c5EL8Crkttsa/AXQVDmutfyku0E7jShx49XqV3MFK8IryDhYVbj7Sj2P2eBxwcXoe8T8idsKKPRcnZw1b+slFTubwUwhktrfnAt7J++jwQtLZcm3sr9LQrjRzz6cfMv9aLvgmnAGvpoaGLxM4mAEaLV7iAzQ3oU0IvD5x9ix3yF2RAAuYAOO2f7PEFWCXZ4C9Pb2UsgDeVnFSpbFK7/IWu7TPTvBqzbGdCHOJQSxiEjt6IyZmxQyEJHv6xyQsYk//moVFsN2zP6fRImjfq7/n/wFDguUQFNEwugAAAABJRU5ErkJggg==');
  }

  div.callout-important.callout-style-default .callout-title {
    background-color: #f7dddc
  }

  div.callout-warning {
    border-left-color: #f0ad4e !important;
  }

  div.callout-warning .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAETklEQVRYCeVWW2gcVRg+58yaTUnizqbipZeX4uWhBEniBaoUX1Ioze52t7sRq6APio9V9MEaoWlVsFasRq0gltaAPuxms8lu0gcviE/FFOstVbSIxgcv6SU7EZqmdc7v9+9mJtNks51NTUH84ed889/PP+cmxP+d5FIbMJmNbpREu4WUkiTtCicKny0l1pIKmBzovF2S+hIJHX8iEu3hZJ5lNZGqyRrGSIQpq15AzF28jgpeY6yk6GVdrfFqdrD6Iw+QlB8g0YS2g7dyQmXM/IDhBhT0UCiRf59lfqmmDvzRt6kByV/m4JjtzuaujMUM2c5Z2d6JdKrRb3K2q6mA+oYVz8JnDdKPmmNthzkAk/lN63sYPgevrguc72aZX/L9C6x09GYyxBgCX4NlvyGUHOKELlm5rXeR1kchuChJt4SSwyddZRXgvwMGvYo4QSlk3/zkHD8UHxwVJA6zjZZqP8v8kK8OWLnIZtLyCAJagYC4rTGW/9Pqj92N/c+LUaAj27movwbi19tk/whRCIE7Q9vyI6yvRpftAKVTdUjOW40X3h5OXsKCdmFcx0xlLJoSuQngnrJe7Kcjm4OMq9FlC7CMmScQANuNvjfP3PjGXDBaUQmbp296S5L4DrpbrHN1T87ZVEZVCzg1FF0Ft+dKrlLukI+/c9ENo+TvlTDbYFvuKPtQ9+l052rXrgKoWkDAFnvh0wTOmYn8R5f4k/jN/fZiCM1tQx9jQQ4ANhqG4hiL0qIFTGViG9DKB7GYzgubnpofgYRwO+DFjh0Zin2m4b/97EDkXkc+f6xYAPX0KK2I/7fUQuwzuwo/L3AkcjugPNixC8cHf0FyPjWlItmLxWw4Ou9YsQCr5fijMGoD/zpdRy95HRysyXA74MWOnscpO4j2y3HAVisw85hX5+AFBRSHt4ShfLFkIMXTqyKFc46xdzQM6XbAi702a7sy04J0+feReMFKp5q9esYLCqAZYw/k14E/xcLLsFElaornTuJB0svMuJINy8xkIYuL+xPAlWRceH6+HX7THJ0djLUom46zREu7tTkxwmf/FdOZ/sh6Q8qvEAiHpm4PJ4a/doJe0gH1t+aHRgCzOvBvJedEK5OFE5jpm4AGP2a8Dxe3gGJ/pAutug9Gp6he92CsSsWBaEcxGx0FHytmIpuqGkOpldqNYQK8cSoXvd+xLxXADw0kf6UkJNFtdo5MOgaLjiQOQHcn+A6h5NuL2s0qsC2LOM75PcF3yr5STuBSAcGG+meA14K/CI21HcS4LBT6tv0QAh8Dr5l93AhZzG5ZJ4VxAqdZUEl9z7WJ4aN+svMvwHHL21UKTd1mqvChH7/Za5xzXBBKrUcB0TQ+Ulgkfbi/H/YT5EptrGzsEK7tR1B7ln9BBwckYfMiuSqklSznIuoIIOM42MQO+QnduCoFCI0bpkzjCjddHPN/F+2Yu+sd9bKNpVwHhbS3LluK/0zgfwD0xYI5dXuzlQAAAABJRU5ErkJggg==');
  }

  div.callout-warning.callout-style-default .callout-title {
    background-color: #fcefdc
  }

  div.callout-tip {
    border-left-color: #02b875 !important;
  }

  div.callout-tip .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAADr0lEQVRYCe1XTWgTQRj9ZjZV8a9SPIkKgj8I1bMHsUWrqYLVg4Ue6v9BwZOxSYsIerFao7UiUryIqJcqgtpimhbBXoSCVxUFe9CTiogUrUp2Pt+3aUI2u5vdNh4dmMzOzHvvezuz8xNFM0mjnbXaNu1MvFWRXkXEyE6aYOYJpdW4IXuA4r0fo8qqSMDBU0v1HJUgVieAXxzCsdE/YJTdFcVIZQNMyhruOMJKXYFoLfIfIvVIMWdsrd+Rpd86ZmyzzjJmLStqRn0v8lzkb4rVIXvnpScOJuAn2ACC65FkPzEdEy4TPWRLJ2h7z4cArXzzaOdKlbOvKKX25Wl00jSnrwVxAg3o4dRxhO13RBSdNvH0xSARv3adTXbBdTf64IWO2vH0LT+cv4GR1DJt+DUItaQogeBX/chhbTBxEiZ6gftlDNXTrvT7co4ub5A6gp9HIcHvzTa46OS5fBeP87Qm0fQkr4FsYgVQ7Qg+ZayaDg9jhg1GkWj8RG6lkeSacrrHgDaxdoBiZPg+NXV/KifMuB6//JmYH4CntVEHy/keA6x4h4CU5oFy8GzrBS18cLJMXcljAKB6INjWsRcuZBWVaS3GDrqB7rdapVIeA+isQ57Eev9eCqzqOa81CY05VLd6SamW2wA2H3SiTbnbSxmzfp7WtKZkqy4mdyAlGx7ennghYf8voqp9cLSgKdqNfa6RdRsAAkPwRuJZNbpByn+RrJi1RXTwdi8RQF6ymDwGMAtZ6TVE+4uoKh+MYkcLsT0Hk8eAienbiGdjJHZTpmNjlbFJNKDVAp2fJlYju6IreQxQ08UJDNYdoLSl6AadO+fFuCQqVMB1NJwPm69T04Wv5WhfcWyfXQB+wXRs1pt+nCknRa0LVzSA/2B+a9+zQJadb7IyyV24YAxKp2Jqs3emZTuNnKxsah+uabKbMk7CbTgJx/zIgQYErIeTKRQ9yD9wxVof5YolPHqaWo7TD6tJlh7jQnK5z2n3+fGdggIOx2kaa2YI9QWarc5Ce1ipNWMKeSG4DysFF52KBmTNMmn5HqCFkwy34rDg05gDwgH3bBi+sgFhN/e8QvRn8kbamCOhgrZ9GJhFDgfcMHzFb6BAtjKpFhzTjwv1KCVuxHvCbsSiEz4CANnj84cwHdFXAbAOJ4LTSAawGWFn5tDhLMYz6nWeU2wJfIhmIJBefcd/A5FWQWGgrWzyORZ3Q6HuV+Jf0Bj+BTX69fm1zWgK7By1YTXchFDORywnfQ7GpzOo6S+qECrsx2ifVQAAAABJRU5ErkJggg==');
  }

  div.callout-tip.callout-style-default .callout-title {
    background-color: #ccf1e3
  }

  div.callout-caution {
    border-left-color: #fd7e14 !important;
  }

  div.callout-caution .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAACV0lEQVRYCdVWzWoUQRCuqp2ICBLJXgITZL1EfQDBW/bkzUMUD7klD+ATSHBEfAIfQO+iXsWDxJsHL96EHAwhgzlkg8nBg25XWb0zIb0zs9muYYWkoKeru+vn664fBqElyZNuyh167NXJ8Ut8McjbmEraKHkd7uAnAFku+VWdb3reSmRV8PKSLfZ0Gjn3a6Xlcq9YGb6tADjn+lUfTXtVmaZ1KwBIvFI11rRXlWlatwIAAv2asaa9mlB9wwygiDX26qaw1yYPzFXg2N1GgG0FMF8Oj+VIx7E/03lHx8UhvYyNZLN7BwSPgekXXLribw7w5/c8EF+DBK5idvDVYtEEwMeYefjjLAdEyQ3M9nfOkgnPTEkYU+sxMq0BxNR6jExrAI31H1rzvLEfRIdgcv1XEdj6QTQAS2wtstEALLG1yEZ3QhH6oDX7ExBSFEkFINXH98NTrme5IOaaA7kIfiu2L8A3qhH9zRbukdCqdsA98TdElyeMe5BI8Rs2xHRIsoTSSVFfCFCWGPn9XHb4cdobRIWABNf0add9jakDjQJpJ1bTXOJXnnRXHRf+dNL1ZV1MBRCXhMbaHqGI1JkKIL7+i8uffuP6wVQAzO7+qVEbF6NbS0LJureYcWXUUhH66nLR5rYmva+2tjRFtojkM2aD76HEGAD3tPtKM309FJg5j/K682ywcWJ3PASCcycH/22u+Bh7Aa0ehM2Fu4z0SAE81HF9RkB21c5bEn4Dzw+/qNOyXr3DCTQDMBOdhi4nAgiFDGCinIa2owCEChUwD8qzd03PG+qdW/4fDzjUMcE1ZpIAAAAASUVORK5CYII=');
  }

  div.callout-caution.callout-style-default .callout-title {
    background-color: #ffe5d0
  }

  </style>
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
<meta property="og:title" content="Causality Part 2 – BSMM-8740 - Fall 2024">
<meta property="og:description" content="BSMM8740-2-R-2024F [WEEK - 8]">
<meta property="og:site_name" content="BSMM-8740 - Fall 2024">
<meta name="twitter:title" content="Causality Part 2 – BSMM-8740 - Fall 2024">
<meta name="twitter:description" content="BSMM8740-2-R-2024F [WEEK - 8]">
<meta name="twitter:image" content="https://bsmm-8740-fall-2024.github.io/osb/slides/images/twitter-card.png">
<meta name="twitter:creator" content="@lodette">
<meta name="twitter:card" content="summary_large_image">
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">Causality Part 2</h1>
  <p class="subtitle">BSMM8740-2-R-2024F [WEEK - 8]</p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
L.L. Odette 
</div>
</div>
</div>

</section>
<section id="recap-of-last-week" class="slide level2">
<h2>Recap of last week</h2>
<ul>
<li>Last week we introduced DAGs as a method to represent our causal assumptions and infer how we might estimate the causal effects of interest.</li>
<li>We worked through a method to estimate causal effects using IPW.</li>
</ul>
</section>
<section id="this-week" class="slide level2">
<h2>This week</h2>
<ul>
<li>We will look at other methods used to estimate causal effects, along with methods used for special situations.</li>
</ul>
</section>
<section id="packages" class="slide level2">
<h2>Packages</h2>
</section>
<section id="section" class="slide level2">
<h2></h2>
</section>
<section>
<section id="causal-effect-estimation" class="title-slide slide level1 center">
<h1>Causal Effect Estimation</h1>

</section>
<section id="inverse-probability-weighting" class="slide level2">
<h2>Inverse Probability Weighting</h2>
<p>Last week we used IPW to create a pseudopopulation where, for every confounder level, the numbers of treated and untreated were balanced.</p>
<p>IPW requires us to build a model to predict the treatment, depending on the confounders (assuming we have data for all the confounders).</p>
</section>
<section id="inverse-probability-weighting-1" class="slide level2">
<h2>Inverse Probability Weighting</h2>
<p>Repeating our prior process, first we calculate the ipw weights and estimate the ate using the weights.</p>
<div class="cell">
<details class="code-fold">
<summary>ATE estimate by IPW</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a></a>dat_ <span class="ot">&lt;-</span> causalworkshop<span class="sc">::</span>net_data <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">net =</span> <span class="fu">as.numeric</span>(net))</span>
<span id="cb1-2"><a></a></span>
<span id="cb1-3"><a></a>propensity_model <span class="ot">&lt;-</span> <span class="fu">glm</span>(</span>
<span id="cb1-4"><a></a>  net <span class="sc">~</span> income <span class="sc">+</span> health <span class="sc">+</span> temperature</span>
<span id="cb1-5"><a></a>  , <span class="at">data =</span> dat_, <span class="at">family =</span> <span class="fu">binomial</span>()</span>
<span id="cb1-6"><a></a>)</span>
<span id="cb1-7"><a></a></span>
<span id="cb1-8"><a></a>net_data_wts <span class="ot">&lt;-</span> propensity_model <span class="sc">|&gt;</span></span>
<span id="cb1-9"><a></a>  broom<span class="sc">::</span><span class="fu">augment</span>(<span class="at">newdata =</span> dat_, <span class="at">type.predict =</span> <span class="st">"response"</span>) <span class="sc">|&gt;</span></span>
<span id="cb1-10"><a></a>  <span class="co"># .fitted is the value predicted by the model</span></span>
<span id="cb1-11"><a></a>  <span class="co"># for a given observation</span></span>
<span id="cb1-12"><a></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">wts =</span> propensity<span class="sc">::</span><span class="fu">wt_ate</span>(.fitted, <span class="at">.exposure =</span> net))</span>
<span id="cb1-13"><a></a>  <span class="co"># alternatively:</span></span>
<span id="cb1-14"><a></a>  <span class="co"># dplyr::mutate(</span></span>
<span id="cb1-15"><a></a>  <span class="co">#   ipw = dplyr::case_when(net == 1 ~ 1/.fitted, TRUE ~ 1/(1-.fitted))</span></span>
<span id="cb1-16"><a></a>  <span class="co">#   , wts_alt = (net / .fitted) + ((1 - net) / (1 - .fitted) )</span></span>
<span id="cb1-17"><a></a>  <span class="co"># )</span></span>
<span id="cb1-18"><a></a></span>
<span id="cb1-19"><a></a>net_data_wts <span class="sc">|&gt;</span></span>
<span id="cb1-20"><a></a>  <span class="fu">lm</span>(malaria_risk <span class="sc">~</span> net, <span class="at">data =</span> _, <span class="at">weights =</span> wts) <span class="sc">|&gt;</span></span>
<span id="cb1-21"><a></a>  broom<span class="sc">::</span><span class="fu">tidy</span>(<span class="at">conf.int =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 7
  term   estimate std.error statistic  p.value conf.low
  &lt;chr&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
1 (Inte…     42.7     0.442      96.7 0            41.9
2 net       -12.5     0.624     -20.1 5.50e-81    -13.8
# ℹ 1 more variable: conf.high &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="inverse-probability-weighting-2" class="slide level2">
<h2>Inverse Probability Weighting</h2>
<p>Using <code>propensity::wt_ate</code> calculates <strong>unstabilized</strong> weights by default. In the last lecture we looked at the distribution of weights and decided they were stable enough, because none of the weights were too big or too small.</p>

<img data-src="BSMM_8740_lec_08_files/figure-revealjs/fig-ate-density-net-data-1.png" width="480" class="r-stretch quarto-figure-center"><p class="caption">
Figure&nbsp;1: A density plot of the average treatment effect (ATE) weights. The plot is skewed, with higher values towards 8. This may indicate a problem with the model, but the weights aren’t so extreme to destabilize the variance of the estimate.
</p><p>Let’s explore the question of IPW stabilization a bit more.</p>
</section>
<section id="inverse-probability-weighting-3" class="slide level2">
<h2>Inverse Probability Weighting</h2>
<h3 id="stabilized-weights">Stabilized weights</h3>
<p>The IP weights (given covariate set <span class="math inline">\(L\)</span>) are <span class="math inline">\(W^A=1/\mathbb{E}[D|L]\)</span>. Because the denominator can be very close to <span class="math inline">\(0\)</span> or <span class="math inline">\(1\)</span> the estimates using these weights can be unstable.</p>
<p>Stabilized weights are often used to address this, e.g.&nbsp;the function <code>propensity::wt_ate</code> with stabilize = TRUE multiplies the weights by the mean of the treatment so in this case <span class="math inline">\(SW^A=\mathbb{E}[D]/\mathbb{E}[D|L]\)</span>.</p>
</section>
<section id="inverse-probability-weighting-4" class="slide level2">
<h2>Inverse Probability Weighting</h2>
<h3 id="v-stabilized-weights">V-Stabilized weights</h3>
<p>Baseline covariates (<span class="math inline">\(V\subset L\)</span>) are also used to stabilize IP weights: <span class="math inline">\(SW^A(V)=\mathbb{E}[D|V]/\mathbb{E}[D|L]\)</span>.</p>
<p>Note the the variables <span class="math inline">\(V\)</span> need to be included in the numerator and the denominator (as part of <span class="math inline">\(L\)</span>)</p>
<p>V-stabilization results in IP weights that are more stabilized than the ones without V.</p>
</section>
<section id="inverse-probability-weighting-5" class="slide level2">
<h2>Inverse Probability Weighting</h2>
<p>We know that IPW weighting should create a pseudo-population that make the covariates more balanced by treatment. In the last lecture we checked this using histograms. Here we check this via the statistics of the data:</p>
<div class="panel-tabset">
<ul id="tabset-1" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-1-1">unweighted</a></li><li><a href="#tabset-1-2">weighted</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1">
<div class="cell">
<div class="cell-output-display">
<div id="tkiojmpisj" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#tkiojmpisj table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#tkiojmpisj thead, #tkiojmpisj tbody, #tkiojmpisj tfoot, #tkiojmpisj tr, #tkiojmpisj td, #tkiojmpisj th {
  border-style: none;
}

#tkiojmpisj p {
  margin: 0;
  padding: 0;
}

#tkiojmpisj .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#tkiojmpisj .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#tkiojmpisj .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#tkiojmpisj .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#tkiojmpisj .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#tkiojmpisj .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#tkiojmpisj .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#tkiojmpisj .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#tkiojmpisj .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#tkiojmpisj .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#tkiojmpisj .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#tkiojmpisj .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#tkiojmpisj .gt_spanner_row {
  border-bottom-style: hidden;
}

#tkiojmpisj .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#tkiojmpisj .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#tkiojmpisj .gt_from_md > :first-child {
  margin-top: 0;
}

#tkiojmpisj .gt_from_md > :last-child {
  margin-bottom: 0;
}

#tkiojmpisj .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#tkiojmpisj .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#tkiojmpisj .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#tkiojmpisj .gt_row_group_first td {
  border-top-width: 2px;
}

#tkiojmpisj .gt_row_group_first th {
  border-top-width: 2px;
}

#tkiojmpisj .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#tkiojmpisj .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#tkiojmpisj .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#tkiojmpisj .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#tkiojmpisj .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#tkiojmpisj .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#tkiojmpisj .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#tkiojmpisj .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#tkiojmpisj .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#tkiojmpisj .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#tkiojmpisj .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#tkiojmpisj .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#tkiojmpisj .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#tkiojmpisj .gt_left {
  text-align: left;
}

#tkiojmpisj .gt_center {
  text-align: center;
}

#tkiojmpisj .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#tkiojmpisj .gt_font_normal {
  font-weight: normal;
}

#tkiojmpisj .gt_font_bold {
  font-weight: bold;
}

#tkiojmpisj .gt_font_italic {
  font-style: italic;
}

#tkiojmpisj .gt_super {
  font-size: 65%;
}

#tkiojmpisj .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#tkiojmpisj .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#tkiojmpisj .gt_indent_1 {
  text-indent: 5px;
}

#tkiojmpisj .gt_indent_2 {
  text-indent: 10px;
}

#tkiojmpisj .gt_indent_3 {
  text-indent: 15px;
}

#tkiojmpisj .gt_indent_4 {
  text-indent: 20px;
}

#tkiojmpisj .gt_indent_5 {
  text-indent: 25px;
}

#tkiojmpisj .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#tkiojmpisj div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header gt_col_headings">
<th id="<div data-qmd-base64=&quot;KipDaGFyYWN0ZXJpc3RpYyoq&quot;><div class='gt_from_md'><p><strong>Characteristic</strong></p>
</div></div>" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col"><p><strong>Characteristic</strong></p></th>
<th id="<div data-qmd-base64=&quot;KiowKiogIApOID0gMSwyOTg=&quot;><div class='gt_from_md'><p><strong>0</strong><br />
N = 1,298</p>
</div></div><span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;line-height: 0;&quot;><sup>1</sup></span>" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"><p><strong>0</strong><br>
N = 1,298</p>
<span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;line-height: 0;"><sup>1</sup></span></th>
<th id="<div data-qmd-base64=&quot;KioxKiogIApOID0gNDU0&quot;><div class='gt_from_md'><p><strong>1</strong><br />
N = 454</p>
</div></div><span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;line-height: 0;&quot;><sup>1</sup></span>" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"><p><strong>1</strong><br>
N = 454</p>
<span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;line-height: 0;"><sup>1</sup></span></th>
<th id="<div data-qmd-base64=&quot;KipPdmVyYWxsKiogIApOID0gMSw3NTI=&quot;><div class='gt_from_md'><p><strong>Overall</strong><br />
N = 1,752</p>
</div></div><span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;line-height: 0;&quot;><sup>1</sup></span>" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"><p><strong>Overall</strong><br>
N = 1,752</p>
<span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;line-height: 0;"><sup>1</sup></span></th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="label">income</td>
<td class="gt_row gt_center" headers="stat_1">880 (751, 1,010)</td>
<td class="gt_row gt_center" headers="stat_2">954 (806, 1,081)</td>
<td class="gt_row gt_center" headers="stat_0">893 (765, 1,031)</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">health</td>
<td class="gt_row gt_center" headers="stat_1">49 (35, 61)</td>
<td class="gt_row gt_center" headers="stat_2">54 (40, 68)</td>
<td class="gt_row gt_center" headers="stat_0">50 (37, 64)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">temperature</td>
<td class="gt_row gt_center" headers="stat_1">23.9 (21.0, 27.1)</td>
<td class="gt_row gt_center" headers="stat_2">23.5 (20.6, 26.9)</td>
<td class="gt_row gt_center" headers="stat_0">23.8 (20.9, 27.1)</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">malaria_risk</td>
<td class="gt_row gt_center" headers="stat_1">41 (32, 54)</td>
<td class="gt_row gt_center" headers="stat_2">26 (20, 32)</td>
<td class="gt_row gt_center" headers="stat_0">36 (28, 50)</td>
</tr>
</tbody><tfoot class="gt_footnotes">
<tr class="odd">
<td colspan="4" class="gt_footnote"><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;line-height: 0;"><sup>1</sup></span>
<p>Median (Q1, Q3)</p></td>
</tr>
</tfoot>

</table>

</div>
</div>
</div>
</div>
<div id="tabset-1-2">
<div class="cell">
<div class="cell-output-display">
<div id="dtlhwbhnej" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#dtlhwbhnej table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#dtlhwbhnej thead, #dtlhwbhnej tbody, #dtlhwbhnej tfoot, #dtlhwbhnej tr, #dtlhwbhnej td, #dtlhwbhnej th {
  border-style: none;
}

#dtlhwbhnej p {
  margin: 0;
  padding: 0;
}

#dtlhwbhnej .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#dtlhwbhnej .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#dtlhwbhnej .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#dtlhwbhnej .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#dtlhwbhnej .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#dtlhwbhnej .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#dtlhwbhnej .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#dtlhwbhnej .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#dtlhwbhnej .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#dtlhwbhnej .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#dtlhwbhnej .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#dtlhwbhnej .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#dtlhwbhnej .gt_spanner_row {
  border-bottom-style: hidden;
}

#dtlhwbhnej .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#dtlhwbhnej .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#dtlhwbhnej .gt_from_md > :first-child {
  margin-top: 0;
}

#dtlhwbhnej .gt_from_md > :last-child {
  margin-bottom: 0;
}

#dtlhwbhnej .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#dtlhwbhnej .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#dtlhwbhnej .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#dtlhwbhnej .gt_row_group_first td {
  border-top-width: 2px;
}

#dtlhwbhnej .gt_row_group_first th {
  border-top-width: 2px;
}

#dtlhwbhnej .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#dtlhwbhnej .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#dtlhwbhnej .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#dtlhwbhnej .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#dtlhwbhnej .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#dtlhwbhnej .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#dtlhwbhnej .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#dtlhwbhnej .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#dtlhwbhnej .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#dtlhwbhnej .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#dtlhwbhnej .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#dtlhwbhnej .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#dtlhwbhnej .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#dtlhwbhnej .gt_left {
  text-align: left;
}

#dtlhwbhnej .gt_center {
  text-align: center;
}

#dtlhwbhnej .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#dtlhwbhnej .gt_font_normal {
  font-weight: normal;
}

#dtlhwbhnej .gt_font_bold {
  font-weight: bold;
}

#dtlhwbhnej .gt_font_italic {
  font-style: italic;
}

#dtlhwbhnej .gt_super {
  font-size: 65%;
}

#dtlhwbhnej .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#dtlhwbhnej .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#dtlhwbhnej .gt_indent_1 {
  text-indent: 5px;
}

#dtlhwbhnej .gt_indent_2 {
  text-indent: 10px;
}

#dtlhwbhnej .gt_indent_3 {
  text-indent: 15px;
}

#dtlhwbhnej .gt_indent_4 {
  text-indent: 20px;
}

#dtlhwbhnej .gt_indent_5 {
  text-indent: 25px;
}

#dtlhwbhnej .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#dtlhwbhnej div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header gt_col_headings">
<th id="<div data-qmd-base64=&quot;KipDaGFyYWN0ZXJpc3RpYyoq&quot;><div class='gt_from_md'><p><strong>Characteristic</strong></p>
</div></div>" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col"><p><strong>Characteristic</strong></p></th>
<th id="<div data-qmd-base64=&quot;KiowKiogIApOID0gMSw3NTE=&quot;><div class='gt_from_md'><p><strong>0</strong><br />
N = 1,751</p>
</div></div><span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;line-height: 0;&quot;><sup>1</sup></span>" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"><p><strong>0</strong><br>
N = 1,751</p>
<span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;line-height: 0;"><sup>1</sup></span></th>
<th id="<div data-qmd-base64=&quot;KioxKiogIApOID0gMSw3NjA=&quot;><div class='gt_from_md'><p><strong>1</strong><br />
N = 1,760</p>
</div></div><span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;line-height: 0;&quot;><sup>1</sup></span>" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"><p><strong>1</strong><br>
N = 1,760</p>
<span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;line-height: 0;"><sup>1</sup></span></th>
<th id="<div data-qmd-base64=&quot;KipPdmVyYWxsKiogIApOID0gMyw1MTE=&quot;><div class='gt_from_md'><p><strong>Overall</strong><br />
N = 3,511</p>
</div></div><span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;line-height: 0;&quot;><sup>1</sup></span>" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"><p><strong>Overall</strong><br>
N = 3,511</p>
<span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;line-height: 0;"><sup>1</sup></span></th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="label">income</td>
<td class="gt_row gt_center" headers="stat_1">892 (767, 1,025)</td>
<td class="gt_row gt_center" headers="stat_2">892 (755, 1,039)</td>
<td class="gt_row gt_center" headers="stat_0">892 (761, 1,031)</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">health</td>
<td class="gt_row gt_center" headers="stat_1">50 (36, 63)</td>
<td class="gt_row gt_center" headers="stat_2">49 (37, 64)</td>
<td class="gt_row gt_center" headers="stat_0">50 (37, 64)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">temperature</td>
<td class="gt_row gt_center" headers="stat_1">23.9 (20.9, 27.1)</td>
<td class="gt_row gt_center" headers="stat_2">23.8 (20.8, 27.3)</td>
<td class="gt_row gt_center" headers="stat_0">23.8 (20.8, 27.2)</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">malaria_risk</td>
<td class="gt_row gt_center" headers="stat_1">40 (31, 53)</td>
<td class="gt_row gt_center" headers="stat_2">28 (23, 34)</td>
<td class="gt_row gt_center" headers="stat_0">33 (26, 45)</td>
</tr>
</tbody><tfoot class="gt_footnotes">
<tr class="odd">
<td colspan="4" class="gt_footnote"><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;line-height: 0;"><sup>1</sup></span>
<p>Median (Q1, Q3)</p></td>
</tr>
</tfoot>

</table>

</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="inverse-probability-weighting-6" class="slide level2">
<h2>Inverse Probability Weighting</h2>
<p>Next we use bootstrapping to generate proper confidence intervals for the effect, first by creating a function to generate (unstabilized) ipw effect estimates for each bootstrap split:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a></a>fit_ipw <span class="ot">&lt;-</span> <span class="cf">function</span>(split, ...) {</span>
<span id="cb3-2"><a></a>  <span class="co"># get bootstrapped data sample with `rsample::analysis()`</span></span>
<span id="cb3-3"><a></a>  <span class="cf">if</span>(<span class="st">"rsplit"</span> <span class="sc">%in%</span> <span class="fu">class</span>(split)){</span>
<span id="cb3-4"><a></a>    .df <span class="ot">&lt;-</span> rsample<span class="sc">::</span><span class="fu">analysis</span>(split)</span>
<span id="cb3-5"><a></a>  }<span class="cf">else</span> <span class="cf">if</span>(<span class="st">"data.frame"</span> <span class="sc">%in%</span> <span class="fu">class</span>(split)){</span>
<span id="cb3-6"><a></a>    .df <span class="ot">&lt;-</span> split</span>
<span id="cb3-7"><a></a>  }</span>
<span id="cb3-8"><a></a></span>
<span id="cb3-9"><a></a>  <span class="co"># fit propensity score model</span></span>
<span id="cb3-10"><a></a>  propensity_model <span class="ot">&lt;-</span> <span class="fu">glm</span>(</span>
<span id="cb3-11"><a></a>    net <span class="sc">~</span> income <span class="sc">+</span> health <span class="sc">+</span> temperature,</span>
<span id="cb3-12"><a></a>    <span class="at">data =</span> .df,</span>
<span id="cb3-13"><a></a>    <span class="at">family =</span> <span class="fu">binomial</span>()</span>
<span id="cb3-14"><a></a>  )</span>
<span id="cb3-15"><a></a></span>
<span id="cb3-16"><a></a>  <span class="co"># calculate inverse probability weights</span></span>
<span id="cb3-17"><a></a>  .df <span class="ot">&lt;-</span> propensity_model <span class="sc">|&gt;</span></span>
<span id="cb3-18"><a></a>    broom<span class="sc">::</span><span class="fu">augment</span>(<span class="at">type.predict =</span> <span class="st">"response"</span>, <span class="at">data =</span> .df) <span class="sc">|&gt;</span></span>
<span id="cb3-19"><a></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">wts =</span> propensity<span class="sc">::</span><span class="fu">wt_ate</span>(.fitted, net))</span>
<span id="cb3-20"><a></a></span>
<span id="cb3-21"><a></a>  <span class="co"># fit correctly bootstrapped ipw model</span></span>
<span id="cb3-22"><a></a>  <span class="fu">lm</span>(malaria_risk <span class="sc">~</span> net, <span class="at">data =</span> .df, <span class="at">weights =</span> wts) <span class="sc">|&gt;</span></span>
<span id="cb3-23"><a></a>    broom<span class="sc">::</span><span class="fu">tidy</span>()</span>
<span id="cb3-24"><a></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="inverse-probability-weighting-7" class="slide level2">
<h2>Inverse Probability Weighting</h2>
<p>Next we use our function to bootstrap proper confidence intervals:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a></a><span class="co"># create bootstrap samples</span></span>
<span id="cb4-2"><a></a>bootstrapped_net_data <span class="ot">&lt;-</span> rsample<span class="sc">::</span><span class="fu">bootstraps</span>(</span>
<span id="cb4-3"><a></a>  dat_,</span>
<span id="cb4-4"><a></a>  <span class="at">times =</span> <span class="dv">1000</span>,</span>
<span id="cb4-5"><a></a>  <span class="co"># required to calculate CIs later</span></span>
<span id="cb4-6"><a></a>  <span class="at">apparent =</span> <span class="cn">TRUE</span></span>
<span id="cb4-7"><a></a>)</span>
<span id="cb4-8"><a></a></span>
<span id="cb4-9"><a></a><span class="co"># create ipw and fit each bootstrap sample</span></span>
<span id="cb4-10"><a></a>results <span class="ot">&lt;-</span> bootstrapped_net_data <span class="sc">|&gt;</span></span>
<span id="cb4-11"><a></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb4-12"><a></a>    <span class="at">ipw_fits =</span> purrr<span class="sc">::</span><span class="fu">map</span>(splits, fit_ipw))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="regression-adjustment" class="slide level2">
<h2>Regression Adjustment</h2>
<p>IPW estimates rely on a model to predict the treatment using covariate/confounder values. We know that we can also predict the effect of treatment by building a model to predict the outcome using a regression model, regressing the effect on the treatment and covariate/confounder values.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a></a>outcome_model <span class="ot">&lt;-</span> <span class="fu">glm</span>(</span>
<span id="cb5-2"><a></a>  malaria_risk <span class="sc">~</span> net <span class="sc">+</span> income <span class="sc">+</span> health <span class="sc">+</span> temperature <span class="sc">+</span> insecticide_resistance <span class="sc">+</span></span>
<span id="cb5-3"><a></a>    <span class="fu">I</span>(health<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">I</span>(temperature<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">I</span>(income<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb5-4"><a></a>  <span class="at">data =</span> dat_</span>
<span id="cb5-5"><a></a>)</span>
<span id="cb5-6"><a></a></span>
<span id="cb5-7"><a></a>outcome_model <span class="sc">|&gt;</span> broom<span class="sc">::</span><span class="fu">tidy</span>(<span class="at">conf.int =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9 × 7
  term  estimate std.error statistic   p.value conf.low
  &lt;chr&gt;    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
1 (Int…  1.08e+2   3.55e+0    30.5   1.89e-164  1.01e+2
2 net   -1.24e+1   2.30e-1   -53.8   0         -1.28e+1
3 inco… -1.65e-1   4.58e-3   -36.1   3.48e-213 -1.74e-1
4 heal…  2.01e-1   2.82e-2     7.13  1.44e- 12  1.46e-1
5 temp…  7.69e-1   2.62e-1     2.93  3.42e-  3  2.55e-1
6 inse…  2.19e-1   6.89e-3    31.8   4.97e-175  2.05e-1
7 I(he… -6.60e-4   2.65e-4    -2.49  1.28e-  2 -1.18e-3
8 I(te…  5.01e-3   5.46e-3     0.919 3.58e-  1 -5.68e-3
9 I(in…  5.02e-5   2.50e-6    20.1   1.04e- 80  4.53e-5
# ℹ 1 more variable: conf.high &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="regression-adjustment-1" class="slide level2">
<h2>Regression Adjustment</h2>
<p>And we can also bootstrap the regression adjustment estimates to get confidence intervals, first by creating the estimation function, then generating bootstrapped estimates, like we did with IPWs:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a></a>fit_reg <span class="ot">&lt;-</span> <span class="cf">function</span>(split, ...) {</span>
<span id="cb7-2"><a></a>  <span class="co"># get bootstrapped data sample with `rsample::analysis()`</span></span>
<span id="cb7-3"><a></a>  <span class="cf">if</span>(<span class="st">"rsplit"</span> <span class="sc">%in%</span> <span class="fu">class</span>(split)){</span>
<span id="cb7-4"><a></a>    .df <span class="ot">&lt;-</span> rsample<span class="sc">::</span><span class="fu">analysis</span>(split)</span>
<span id="cb7-5"><a></a>  }<span class="cf">else</span> <span class="cf">if</span>(<span class="st">"data.frame"</span> <span class="sc">%in%</span> <span class="fu">class</span>(split)){</span>
<span id="cb7-6"><a></a>    .df <span class="ot">&lt;-</span> split</span>
<span id="cb7-7"><a></a>  }</span>
<span id="cb7-8"><a></a></span>
<span id="cb7-9"><a></a>  <span class="co"># fit outcome model</span></span>
<span id="cb7-10"><a></a>  <span class="fu">glm</span>(malaria_risk <span class="sc">~</span> net <span class="sc">+</span> income <span class="sc">+</span> health <span class="sc">+</span> temperature <span class="sc">+</span> insecticide_resistance <span class="sc">+</span></span>
<span id="cb7-11"><a></a>      <span class="fu">I</span>(health<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">I</span>(temperature<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">I</span>(income<span class="sc">^</span><span class="dv">2</span>), <span class="at">data =</span> .df</span>
<span id="cb7-12"><a></a>    )<span class="sc">|&gt;</span></span>
<span id="cb7-13"><a></a>    broom<span class="sc">::</span><span class="fu">tidy</span>()</span>
<span id="cb7-14"><a></a>}</span>
<span id="cb7-15"><a></a></span>
<span id="cb7-16"><a></a>both_results <span class="ot">&lt;-</span> results <span class="sc">|&gt;</span></span>
<span id="cb7-17"><a></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb7-18"><a></a>    <span class="at">reg_fits =</span> purrr<span class="sc">::</span><span class="fu">map</span>(splits, fit_reg))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="ipw-vs-regression-adjustment" class="slide level2">
<h2>IPW vs Regression Adjustment</h2>
<p>We can compare the results:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a></a>both_results_dat <span class="ot">&lt;-</span> both_results <span class="sc">|&gt;</span></span>
<span id="cb8-2"><a></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb8-3"><a></a>    <span class="at">reg_estimate =</span> purrr<span class="sc">::</span><span class="fu">map_dbl</span>(</span>
<span id="cb8-4"><a></a>      reg_fits,</span>
<span id="cb8-5"><a></a>      <span class="co"># pull the `estimate` for net for each fit</span></span>
<span id="cb8-6"><a></a>      \(.fit) .fit <span class="sc">|&gt;</span></span>
<span id="cb8-7"><a></a>        dplyr<span class="sc">::</span><span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">"net"</span>) <span class="sc">|&gt;</span></span>
<span id="cb8-8"><a></a>        dplyr<span class="sc">::</span><span class="fu">pull</span>(estimate)</span>
<span id="cb8-9"><a></a>    )</span>
<span id="cb8-10"><a></a>    , <span class="at">ipw_estimate =</span> purrr<span class="sc">::</span><span class="fu">map_dbl</span>(</span>
<span id="cb8-11"><a></a>      ipw_fits,</span>
<span id="cb8-12"><a></a>      <span class="co"># pull the `estimate` for net for each fit</span></span>
<span id="cb8-13"><a></a>      \(.fit) .fit <span class="sc">|&gt;</span></span>
<span id="cb8-14"><a></a>        dplyr<span class="sc">::</span><span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">"net"</span>) <span class="sc">|&gt;</span></span>
<span id="cb8-15"><a></a>        dplyr<span class="sc">::</span><span class="fu">pull</span>(estimate)</span>
<span id="cb8-16"><a></a>    )</span>
<span id="cb8-17"><a></a>  ) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="ipw-vs-regression-adjustment-1" class="slide level2">
<h2>IPW vs Regression Adjustment</h2>
<p>We can plot the results:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a></a>dat <span class="ot">&lt;-</span> both_results_dat <span class="sc">|&gt;</span> </span>
<span id="cb9-2"><a></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(reg_estimate, ipw_estimate) <span class="sc">|&gt;</span> </span>
<span id="cb9-3"><a></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="at">cols=</span><span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"method"</span>, <span class="at">values_to =</span> <span class="st">"effect estimate"</span>)</span>
<span id="cb9-4"><a></a></span>
<span id="cb9-5"><a></a>dat <span class="sc">|&gt;</span></span>
<span id="cb9-6"><a></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">method=</span><span class="fu">factor</span>(method)) <span class="sc">|&gt;</span></span>
<span id="cb9-7"><a></a>  <span class="fu">ggplot</span>( <span class="at">bins =</span> <span class="dv">50</span>, <span class="at">alpha =</span> .<span class="dv">5</span></span>
<span id="cb9-8"><a></a>    , <span class="fu">aes</span>(</span>
<span id="cb9-9"><a></a>      <span class="st">`</span><span class="at">effect estimate</span><span class="st">`</span>, <span class="fu">after_stat</span>(density) , <span class="at">colour =</span> method, <span class="at">fill =</span> method</span>
<span id="cb9-10"><a></a>      )</span>
<span id="cb9-11"><a></a>  ) <span class="sc">+</span></span>
<span id="cb9-12"><a></a>  <span class="fu">geom_histogram</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">position =</span> <span class="st">'identity'</span>) <span class="sc">+</span></span>
<span id="cb9-13"><a></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb9-14"><a></a>  <span class="fu">theme</span>(<span class="at">legend.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>), <span class="at">legend.title =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="BSMM_8740_lec_08_files/figure-revealjs/combined reg &amp; ipw plot-1.png" width="960" class="r-stretch"></section>
<section id="ipw-vs-regression-adjustment-2" class="slide level2">
<h2>IPW vs Regression Adjustment</h2>
<p>We can compare the means and the confidence intervals of the regression adjustment and IPW effect estimates:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a></a>dat <span class="sc">|&gt;</span> </span>
<span id="cb10-2"><a></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(method) <span class="sc">|&gt;</span> </span>
<span id="cb10-3"><a></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb10-4"><a></a>  <span class="at">mean =</span> <span class="fu">mean</span>(<span class="st">`</span><span class="at">effect estimate</span><span class="st">`</span>)</span>
<span id="cb10-5"><a></a>  , <span class="at">lower_ci =</span> <span class="fu">quantile</span>(<span class="st">`</span><span class="at">effect estimate</span><span class="st">`</span>, <span class="fl">0.025</span>)</span>
<span id="cb10-6"><a></a>  , <span class="at">upper_ci =</span> <span class="fu">quantile</span>(<span class="st">`</span><span class="at">effect estimate</span><span class="st">`</span>, <span class="fl">0.975</span>)</span>
<span id="cb10-7"><a></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 4
  method        mean lower_ci upper_ci
  &lt;chr&gt;        &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
1 ipw_estimate -12.6    -13.4    -11.6
2 reg_estimate -12.4    -12.9    -11.8</code></pre>
</div>
</div>
<p>Note that each mean ate estimate is within the CIs of the other ate mean estimate.</p>
</section>
<section id="ipw-vs-regression-adjustment-3" class="slide level2">
<h2>IPW vs Regression Adjustment</h2>
<p>There is a package (<code>boot</code>) that performs cross-validation and CI estimation at the same time:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a></a><span class="co"># bootstrap (1000 times) using the fit_reg function</span></span>
<span id="cb12-2"><a></a>boot_out_reg <span class="ot">&lt;-</span> boot<span class="sc">::</span><span class="fu">boot</span>(</span>
<span id="cb12-3"><a></a>  <span class="at">data =</span> causalworkshop<span class="sc">::</span>net_data <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">net =</span> <span class="fu">as.numeric</span>(net))</span>
<span id="cb12-4"><a></a>  , <span class="at">R =</span> <span class="dv">1000</span></span>
<span id="cb12-5"><a></a>  , <span class="at">sim =</span> <span class="st">"ordinary"</span></span>
<span id="cb12-6"><a></a>  , <span class="at">statistic =</span></span>
<span id="cb12-7"><a></a>    (\(x,y){ <span class="co"># x is the data, y is a vector of row numbers for the bootstrap sample</span></span>
<span id="cb12-8"><a></a>      <span class="fu">fit_reg</span>(x[y,]) <span class="sc">|&gt;</span></span>
<span id="cb12-9"><a></a>        dplyr<span class="sc">::</span><span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">"net"</span>) <span class="sc">|&gt;</span></span>
<span id="cb12-10"><a></a>        dplyr<span class="sc">::</span><span class="fu">pull</span>(estimate)</span>
<span id="cb12-11"><a></a>    })</span>
<span id="cb12-12"><a></a>)</span>
<span id="cb12-13"><a></a><span class="co"># calculate the CIs</span></span>
<span id="cb12-14"><a></a>CIs <span class="ot">&lt;-</span> boot_out_reg <span class="sc">|&gt;</span></span>
<span id="cb12-15"><a></a>  boot<span class="sc">::</span><span class="fu">boot.ci</span>(<span class="at">L =</span> boot<span class="sc">::</span><span class="fu">empinf</span>(boot_out_reg, <span class="at">index=</span><span class="dv">1</span>L, <span class="at">type=</span><span class="st">"jack"</span>))</span>
<span id="cb12-16"><a></a></span>
<span id="cb12-17"><a></a>tibble<span class="sc">::</span><span class="fu">tibble</span>(<span class="at">CI =</span> <span class="fu">c</span>(<span class="st">"lower"</span>, <span class="st">"upper"</span>), <span class="at">normal =</span> CIs<span class="sc">$</span>normal[<span class="sc">-</span><span class="dv">1</span>], <span class="at">basic =</span> CIs<span class="sc">$</span>basic[<span class="sc">-</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)]</span>
<span id="cb12-18"><a></a>               , <span class="at">percent =</span> CIs<span class="sc">$</span>percent[<span class="sc">-</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 4
  CI    normal basic percent
  &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;
1 lower  -12.9 -12.9   -12.9
2 upper  -11.8 -11.8   -11.9</code></pre>
</div>
</div>
</section>
<section id="doubly-robust-estimation" class="slide level2">
<h2>Doubly Robust Estimation</h2>
<h4 id="dont-put-all-your-eggs-in-one-basket">Don’t Put All your Eggs in One Basket</h4>
<p>We’ve learned how to use linear regression and propensity score weighting to estimate <span class="math inline">\(E[Y|D=1] - E[Y|D=0] | X\)</span>. But which one should we use and when?</p>
<p>When in doubt, just use both! Doubly Robust Estimation is a way of combining propensity score and linear regression in a way you don’t have to rely on either of them.</p>
</section>
<section id="doubly-robust-estimation-1" class="slide level2">
<h2>Doubly Robust Estimation</h2>
<p>The estimator is as follows.</p>
<div style="font-size: x-large">
<p><span class="math display">\[
\hat{ATE} = \frac{1}{N}\sum \bigg( \dfrac{D_i(Y_i - \hat{\mu_1}(X_i))}{\hat{P}(X_i)} + \hat{\mu_1}(X_i) \bigg) - \frac{1}{N}\sum \bigg( \dfrac{(1-D_i)(Y_i - \hat{\mu_0}(X_i))}{1-\hat{P}(X_i)} + \hat{\mu_0}(X_i) \bigg)
\]</span></p>
<p>where <span class="math inline">\(\hat{P}(x)\)</span> is an estimation of the propensity score (using logistic regression, for example), <span class="math inline">\(\hat{\mu_1}(x)\)</span> is an estimation of (using linear regression, for example), and is an estimation of <span class="math inline">\(E[Y|X, D=1]\)</span>. As you might have already guessed, the first part of the doubly robust estimator estimates <span class="math inline">\(E[Y^1]\)</span> and the second part estimates <span class="math inline">\(E[Y^0]\)</span>. Let’s examine the first part, as all the intuition will also apply to the second part by analogy.</p>
</div>
</section>
<section id="doubly-robust-estimation-2" class="slide level2">
<h2>Doubly Robust Estimation</h2>
<p>First let’s examine the code. Note we use a recipe with the regression to add the polynomial confounders for each</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a></a>D <span class="ot">&lt;-</span> <span class="st">"net"</span></span>
<span id="cb14-2"><a></a>Y <span class="ot">&lt;-</span> <span class="st">"malaria_risk"</span></span>
<span id="cb14-3"><a></a>X <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="fu">c</span>(<span class="st">'income'</span>, <span class="st">'health'</span>, <span class="st">'temperature'</span>),<span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">'_poly_1'</span>,<span class="dv">3</span>),<span class="fu">rep</span>(<span class="st">'_poly_2'</span>,<span class="dv">3</span>)))</span>
<span id="cb14-4"><a></a></span>
<span id="cb14-5"><a></a>doubly_robust <span class="ot">&lt;-</span> <span class="cf">function</span>(df, X, D, Y){</span>
<span id="cb14-6"><a></a>  ps <span class="ot">&lt;-</span> <span class="co"># propensity score</span></span>
<span id="cb14-7"><a></a>    <span class="fu">as.formula</span>(<span class="fu">paste</span>(D, <span class="st">" ~ "</span>, <span class="fu">paste</span>(X, <span class="at">collapse=</span> <span class="st">"+"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb14-8"><a></a>    stats<span class="sc">::</span><span class="fu">glm</span>( <span class="at">data =</span> df, <span class="at">family =</span> <span class="fu">binomial</span>() ) <span class="sc">|&gt;</span></span>
<span id="cb14-9"><a></a>    broom<span class="sc">::</span><span class="fu">augment</span>(<span class="at">type.predict =</span> <span class="st">"response"</span>, <span class="at">data =</span> df) <span class="sc">|&gt;</span></span>
<span id="cb14-10"><a></a>    dplyr<span class="sc">::</span><span class="fu">pull</span>(.fitted)</span>
<span id="cb14-11"><a></a>  </span>
<span id="cb14-12"><a></a>  lin_frml <span class="ot">&lt;-</span> <span class="fu">formula</span>(<span class="fu">paste</span>(Y, <span class="st">" ~ "</span>, <span class="fu">paste</span>(X, <span class="at">collapse=</span> <span class="st">"+"</span>)))</span>
<span id="cb14-13"><a></a>  </span>
<span id="cb14-14"><a></a>  idx <span class="ot">&lt;-</span> df[,D] <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">pull</span>(<span class="dv">1</span>) <span class="sc">==</span> <span class="dv">0</span></span>
<span id="cb14-15"><a></a>  mu0 <span class="ot">&lt;-</span> <span class="co"># mean response D == 0</span></span>
<span id="cb14-16"><a></a>    <span class="fu">lm</span>(lin_frml, <span class="at">data =</span> df[idx,]) <span class="sc">%&gt;%</span> </span>
<span id="cb14-17"><a></a>    broom<span class="sc">::</span><span class="fu">augment</span>(<span class="at">type.predict =</span> <span class="st">"response"</span>, <span class="at">newdata =</span> df[,X]) <span class="sc">|&gt;</span></span>
<span id="cb14-18"><a></a>    dplyr<span class="sc">::</span><span class="fu">pull</span>(.fitted)</span>
<span id="cb14-19"><a></a>  </span>
<span id="cb14-20"><a></a>  idx <span class="ot">&lt;-</span> df[,D] <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">pull</span>(<span class="dv">1</span>) <span class="sc">==</span> <span class="dv">1</span></span>
<span id="cb14-21"><a></a>  mu1 <span class="ot">&lt;-</span> <span class="co"># mean response D == 1</span></span>
<span id="cb14-22"><a></a>    <span class="fu">lm</span>(lin_frml, <span class="at">data =</span> df[idx,]) <span class="sc">|&gt;</span>  </span>
<span id="cb14-23"><a></a>    broom<span class="sc">::</span><span class="fu">augment</span>(<span class="at">type.predict =</span> <span class="st">"response"</span>, <span class="at">newdata =</span> df[,X]) <span class="sc">|&gt;</span> </span>
<span id="cb14-24"><a></a>    dplyr<span class="sc">::</span><span class="fu">pull</span>(.fitted)</span>
<span id="cb14-25"><a></a>  </span>
<span id="cb14-26"><a></a>  <span class="co"># convert treatment factor to integer | recast as vectors</span></span>
<span id="cb14-27"><a></a>  d <span class="ot">&lt;-</span> df[,D] <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">pull</span>(<span class="dv">1</span>) <span class="sc">|&gt;</span> <span class="fu">as.character</span>() <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>()</span>
<span id="cb14-28"><a></a>  y <span class="ot">&lt;-</span> df[,Y] <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">pull</span>(<span class="dv">1</span>)</span>
<span id="cb14-29"><a></a>  </span>
<span id="cb14-30"><a></a>  <span class="fu">mean</span>( d<span class="sc">*</span>(y <span class="sc">-</span> mu1)<span class="sc">/</span>ps <span class="sc">+</span> mu1 ) <span class="sc">-</span></span>
<span id="cb14-31"><a></a>    <span class="fu">mean</span>(( <span class="dv">1</span><span class="sc">-</span>d)<span class="sc">*</span>(y <span class="sc">-</span> mu0)<span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span>ps) <span class="sc">+</span> mu0 )</span>
<span id="cb14-32"><a></a>}</span>
<span id="cb14-33"><a></a></span>
<span id="cb14-34"><a></a>doubly_robust_rec <span class="ot">&lt;-</span> causalworkshop<span class="sc">::</span>net_data <span class="sc">|&gt;</span> </span>
<span id="cb14-35"><a></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">net =</span> <span class="fu">as.numeric</span>(net)) <span class="sc">|&gt;</span> </span>
<span id="cb14-36"><a></a>  recipes<span class="sc">::</span><span class="fu">recipe</span>(malaria_risk <span class="sc">~</span> net <span class="sc">+</span> income <span class="sc">+</span> health <span class="sc">+</span> temperature) <span class="sc">|&gt;</span> </span>
<span id="cb14-37"><a></a>  recipes<span class="sc">::</span><span class="fu">step_poly</span>(income, health, temperature) <span class="sc">|&gt;</span> </span>
<span id="cb14-38"><a></a>  recipes<span class="sc">::</span><span class="fu">prep</span>() </span>
<span id="cb14-39"><a></a></span>
<span id="cb14-40"><a></a>doubly_robust_dat <span class="ot">&lt;-</span> doubly_robust_rec <span class="sc">|&gt;</span> recipes<span class="sc">::</span><span class="fu">bake</span>(<span class="at">new_data=</span><span class="cn">NULL</span>)</span>
<span id="cb14-41"><a></a>  </span>
<span id="cb14-42"><a></a>doubly_robust_dat <span class="sc">|&gt;</span> </span>
<span id="cb14-43"><a></a>  <span class="fu">doubly_robust</span>(X, D, Y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -12.9</code></pre>
</div>
</div>
</section>
<section id="doubly-robust-estimation-3" class="slide level2">
<h2>Doubly Robust Estimation</h2>
<p>Once again, we can use bootstrap to construct confidence intervals.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a></a>all_results_dat <span class="ot">&lt;-</span> both_results_dat <span class="sc">|&gt;</span></span>
<span id="cb16-2"><a></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb16-3"><a></a>    <span class="at">dre_estimate =</span> </span>
<span id="cb16-4"><a></a>      purrr<span class="sc">::</span><span class="fu">map_dbl</span>(</span>
<span id="cb16-5"><a></a>        splits</span>
<span id="cb16-6"><a></a>        , (\(x){</span>
<span id="cb16-7"><a></a>          <span class="co"># rsample::analysis(x) |&gt; </span></span>
<span id="cb16-8"><a></a>          <span class="co">#   dplyr::mutate(net = as.numeric(net)) |&gt; </span></span>
<span id="cb16-9"><a></a>          <span class="co">#   doubly_robust(X, D, Y)</span></span>
<span id="cb16-10"><a></a></span>
<span id="cb16-11"><a></a>          doubly_robust_rec <span class="sc">|&gt;</span> </span>
<span id="cb16-12"><a></a>            recipes<span class="sc">::</span><span class="fu">bake</span>(<span class="at">new_data =</span> rsample<span class="sc">::</span><span class="fu">analysis</span>(x)) <span class="sc">|&gt;</span> </span>
<span id="cb16-13"><a></a>            <span class="fu">doubly_robust</span>(X, D, Y)</span>
<span id="cb16-14"><a></a>        })</span>
<span id="cb16-15"><a></a>      )</span>
<span id="cb16-16"><a></a>  )</span>
<span id="cb16-17"><a></a></span>
<span id="cb16-18"><a></a>all_results_dat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># Bootstrap sampling with apparent sample 
# A tibble: 1,001 × 7
   splits             id            ipw_fits reg_fits
   &lt;list&gt;             &lt;chr&gt;         &lt;list&gt;   &lt;list&gt;  
 1 &lt;split [1752/647]&gt; Bootstrap0001 &lt;tibble&gt; &lt;tibble&gt;
 2 &lt;split [1752/647]&gt; Bootstrap0002 &lt;tibble&gt; &lt;tibble&gt;
 3 &lt;split [1752/645]&gt; Bootstrap0003 &lt;tibble&gt; &lt;tibble&gt;
 4 &lt;split [1752/645]&gt; Bootstrap0004 &lt;tibble&gt; &lt;tibble&gt;
 5 &lt;split [1752/666]&gt; Bootstrap0005 &lt;tibble&gt; &lt;tibble&gt;
 6 &lt;split [1752/629]&gt; Bootstrap0006 &lt;tibble&gt; &lt;tibble&gt;
 7 &lt;split [1752/657]&gt; Bootstrap0007 &lt;tibble&gt; &lt;tibble&gt;
 8 &lt;split [1752/626]&gt; Bootstrap0008 &lt;tibble&gt; &lt;tibble&gt;
 9 &lt;split [1752/642]&gt; Bootstrap0009 &lt;tibble&gt; &lt;tibble&gt;
10 &lt;split [1752/634]&gt; Bootstrap0010 &lt;tibble&gt; &lt;tibble&gt;
# ℹ 991 more rows
# ℹ 3 more variables: reg_estimate &lt;dbl&gt;,
#   ipw_estimate &lt;dbl&gt;, dre_estimate &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="doubly-robust-estimation-4" class="slide level2">
<h2>Doubly Robust Estimation</h2>
<p>Looking at the histogram/distributions of all the estimates:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a></a>dat <span class="ot">&lt;-</span> all_results_dat <span class="sc">|&gt;</span> </span>
<span id="cb18-2"><a></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(reg_estimate, ipw_estimate, dre_estimate) <span class="sc">|&gt;</span> </span>
<span id="cb18-3"><a></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="at">cols=</span><span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"method"</span>, <span class="at">values_to =</span> <span class="st">"effect estimate"</span>)</span>
<span id="cb18-4"><a></a></span>
<span id="cb18-5"><a></a>dat <span class="sc">|&gt;</span></span>
<span id="cb18-6"><a></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">method=</span><span class="fu">factor</span>(method)) <span class="sc">|&gt;</span></span>
<span id="cb18-7"><a></a>  <span class="fu">ggplot</span>( <span class="at">bins =</span> <span class="dv">50</span>, <span class="at">alpha =</span> .<span class="dv">5</span></span>
<span id="cb18-8"><a></a>    , <span class="fu">aes</span>(</span>
<span id="cb18-9"><a></a>      <span class="st">`</span><span class="at">effect estimate</span><span class="st">`</span>, <span class="fu">after_stat</span>(density) , <span class="at">colour =</span> method, <span class="at">fill =</span> method</span>
<span id="cb18-10"><a></a>      )</span>
<span id="cb18-11"><a></a>  ) <span class="sc">+</span></span>
<span id="cb18-12"><a></a>  <span class="fu">geom_histogram</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">position =</span> <span class="st">'identity'</span>) <span class="sc">+</span></span>
<span id="cb18-13"><a></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb18-14"><a></a>  <span class="fu">theme</span>(<span class="at">legend.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>), <span class="at">legend.title =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="BSMM_8740_lec_08_files/figure-revealjs/dre reg ipw plot-1.png" width="960" class="r-stretch"></section>
<section id="doubly-robust-estimation-5" class="slide level2">
<h2>Doubly Robust Estimation</h2>
<p>Confidence intervals, including the dre are:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a></a>dat <span class="sc">|&gt;</span> </span>
<span id="cb19-2"><a></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(method) <span class="sc">|&gt;</span> </span>
<span id="cb19-3"><a></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb19-4"><a></a>  <span class="at">mean =</span> <span class="fu">mean</span>(<span class="st">`</span><span class="at">effect estimate</span><span class="st">`</span>)</span>
<span id="cb19-5"><a></a>  , <span class="at">lower_ci =</span> <span class="fu">quantile</span>(<span class="st">`</span><span class="at">effect estimate</span><span class="st">`</span>, <span class="fl">0.025</span>)</span>
<span id="cb19-6"><a></a>  , <span class="at">upper_ci =</span> <span class="fu">quantile</span>(<span class="st">`</span><span class="at">effect estimate</span><span class="st">`</span>, <span class="fl">0.975</span>)</span>
<span id="cb19-7"><a></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  method        mean lower_ci upper_ci
  &lt;chr&gt;        &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
1 dre_estimate -12.9    -13.5    -12.3
2 ipw_estimate -12.6    -13.4    -11.6
3 reg_estimate -12.4    -12.9    -11.8</code></pre>
</div>
</div>
<p>All methods are consistent.</p>
</section>
<section id="doubly-robust-estimation-6" class="slide level2">
<h2>Doubly Robust Estimation</h2>
<div style="font-size: x-large">
<p>The doubly robust estimator is called doubly robust because it only requires one of the models, <span class="math inline">\(\hat{P}(x)\)</span> or <span class="math inline">\(\hat{\mu}(x)\)</span>, to be correctly specified. To see this, take the first part that estimates <span class="math inline">\(E[Y^1]\)</span> and take a good look at it.</p>
<p><span class="math display">\[
\hat{E}[Y^1] = \frac{1}{N}\sum \bigg( \dfrac{D_i(Y_i - \hat{\mu_1}(X_i))}{\hat{P}(X_i)} + \hat{\mu_1}(X_i) \bigg)
\]</span></p>
<p>Assume that <span class="math inline">\(\hat{\mu_1}(x)\)</span> is correct. If the propensity score model is wrong, we wouldn’t need to worry. Because if <span class="math inline">\(\hat{\mu_1}(x)\)</span> is correct, then <span class="math inline">\(E[D_i(Y_i - \hat{\mu_1}(X_i))]=0\)</span>. That is because the multiplication by <span class="math inline">\(T_i\)</span> selects only the treated and the residual of <span class="math inline">\(\hat{\mu_1}\)</span> on the treated have, by definition, mean zero. This causes the whole thing to reduce to <span class="math inline">\(\hat{\mu_1}(X_i)\)</span>, which is correctly estimated <span class="math inline">\(E[Y^1]\)</span> by assumption. So, you see, that by being correct, <span class="math inline">\(\hat{\mu_1}(X_i)\)</span> wipes out the relevance of the propensity score model. We can apply the same reasoning to understand the estimator of <span class="math inline">\(E[Y^0]\)</span>.</p>
</div>
</section>
<section id="doubly-robust-estimation-7" class="slide level2">
<h2>Doubly Robust Estimation</h2>
<div style="font-size: x-large">
<p>Replace the propensity score by a random uniform variable that goes from 0.1 to 0.9 (we don’t want very small weights to blow up the propensity score variance). Since this is random, there is no way it is a good propensity score model, but the doubly robust estimator still manages to produce an estimation that is very close to when the propensity score was estimated with logistic regression.</p>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a></a>doubly_robust_bad_ipw <span class="ot">&lt;-</span> <span class="cf">function</span>(df, X, D, Y){</span>
<span id="cb21-2"><a></a>  ps <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="fu">dim</span>(df)[<span class="dv">1</span>], <span class="fl">0.1</span>, <span class="fl">0.9</span>) <span class="co"># wrong propensity score </span></span>
<span id="cb21-3"><a></a>  </span>
<span id="cb21-4"><a></a>  lin_frml <span class="ot">&lt;-</span> <span class="fu">formula</span>(<span class="fu">paste</span>(Y, <span class="st">" ~ "</span>, <span class="fu">paste</span>(X, <span class="at">collapse=</span> <span class="st">"+"</span>)))</span>
<span id="cb21-5"><a></a>  </span>
<span id="cb21-6"><a></a>  idx <span class="ot">&lt;-</span> df[,D] <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">pull</span>(<span class="dv">1</span>) <span class="sc">==</span> <span class="dv">0</span></span>
<span id="cb21-7"><a></a>  mu0 <span class="ot">&lt;-</span> <span class="co"># mean response D == 0</span></span>
<span id="cb21-8"><a></a>    <span class="fu">lm</span>(lin_frml, <span class="at">data =</span> df[idx,]) <span class="sc">%&gt;%</span></span>
<span id="cb21-9"><a></a>    broom<span class="sc">::</span><span class="fu">augment</span>(<span class="at">type.predict =</span> <span class="st">"response"</span>, <span class="at">newdata =</span> df[,X]) <span class="sc">|&gt;</span></span>
<span id="cb21-10"><a></a>    dplyr<span class="sc">::</span><span class="fu">pull</span>(.fitted)</span>
<span id="cb21-11"><a></a>  </span>
<span id="cb21-12"><a></a>  idx <span class="ot">&lt;-</span> df[,D] <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">pull</span>(<span class="dv">1</span>) <span class="sc">==</span> <span class="dv">1</span></span>
<span id="cb21-13"><a></a>  mu1 <span class="ot">&lt;-</span> <span class="co"># mean response D == 1</span></span>
<span id="cb21-14"><a></a>    <span class="fu">lm</span>(lin_frml, <span class="at">data =</span> df[idx,]) <span class="sc">|&gt;</span></span>
<span id="cb21-15"><a></a>    broom<span class="sc">::</span><span class="fu">augment</span>(<span class="at">type.predict =</span> <span class="st">"response"</span>, <span class="at">newdata =</span> df[,X]) <span class="sc">|&gt;</span></span>
<span id="cb21-16"><a></a>    dplyr<span class="sc">::</span><span class="fu">pull</span>(.fitted)</span>
<span id="cb21-17"><a></a>  </span>
<span id="cb21-18"><a></a>  <span class="co"># convert treatment factor to integer | recast as vectors</span></span>
<span id="cb21-19"><a></a>  d <span class="ot">&lt;-</span> df[,D] <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">pull</span>(<span class="dv">1</span>) <span class="sc">|&gt;</span> <span class="fu">as.character</span>() <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>()</span>
<span id="cb21-20"><a></a>  y <span class="ot">&lt;-</span> df[,Y] <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">pull</span>(<span class="dv">1</span>)</span>
<span id="cb21-21"><a></a>  </span>
<span id="cb21-22"><a></a>  <span class="fu">mean</span>( d<span class="sc">*</span>(y <span class="sc">-</span> mu1)<span class="sc">/</span>ps <span class="sc">+</span> mu1 ) <span class="sc">-</span></span>
<span id="cb21-23"><a></a>    <span class="fu">mean</span>(( <span class="dv">1</span><span class="sc">-</span>d)<span class="sc">*</span>(y <span class="sc">-</span> mu0)<span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span>ps) <span class="sc">+</span> mu0 )</span>
<span id="cb21-24"><a></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="doubly-robust-estimation-8" class="slide level2">
<h2>Doubly Robust Estimation</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a></a>all_results_dat <span class="ot">&lt;-</span> all_results_dat <span class="sc">|&gt;</span></span>
<span id="cb22-2"><a></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb22-3"><a></a>    <span class="at">dre_bad_ipw_estimate =</span> </span>
<span id="cb22-4"><a></a>      purrr<span class="sc">::</span><span class="fu">map_dbl</span>(</span>
<span id="cb22-5"><a></a>        splits</span>
<span id="cb22-6"><a></a>        , (\(x){</span>
<span id="cb22-7"><a></a>          <span class="co"># rsample::analysis(x) |&gt; </span></span>
<span id="cb22-8"><a></a>          <span class="co">#   # dplyr::mutate(net = as.numeric(net)) |&gt; # not needed</span></span>
<span id="cb22-9"><a></a>          <span class="co">#   recipes::bake(new_data = rsample::analysis(x)) |&gt; </span></span>
<span id="cb22-10"><a></a>          doubly_robust_rec <span class="sc">|&gt;</span> </span>
<span id="cb22-11"><a></a>            recipes<span class="sc">::</span><span class="fu">bake</span>(<span class="at">new_data =</span> rsample<span class="sc">::</span><span class="fu">analysis</span>(x)) <span class="sc">|&gt;</span> </span>
<span id="cb22-12"><a></a>            <span class="fu">doubly_robust_bad_ipw</span>(X, D, Y)</span>
<span id="cb22-13"><a></a>        })</span>
<span id="cb22-14"><a></a>      )</span>
<span id="cb22-15"><a></a>  )</span>
<span id="cb22-16"><a></a></span>
<span id="cb22-17"><a></a>dat <span class="ot">&lt;-</span> all_results_dat <span class="sc">|&gt;</span> </span>
<span id="cb22-18"><a></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(reg_estimate, ipw_estimate, dre_estimate, dre_bad_ipw_estimate) <span class="sc">|&gt;</span> </span>
<span id="cb22-19"><a></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="at">cols=</span><span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"method"</span>, <span class="at">values_to =</span> <span class="st">"effect estimate"</span>)</span>
<span id="cb22-20"><a></a></span>
<span id="cb22-21"><a></a>dat <span class="sc">|&gt;</span></span>
<span id="cb22-22"><a></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">method=</span><span class="fu">factor</span>(method)) <span class="sc">|&gt;</span></span>
<span id="cb22-23"><a></a>  <span class="fu">ggplot</span>( <span class="at">bins =</span> <span class="dv">50</span>, <span class="at">alpha =</span> .<span class="dv">5</span></span>
<span id="cb22-24"><a></a>    , <span class="fu">aes</span>(</span>
<span id="cb22-25"><a></a>      <span class="st">`</span><span class="at">effect estimate</span><span class="st">`</span>, <span class="fu">after_stat</span>(density) , <span class="at">colour =</span> method, <span class="at">fill =</span> method</span>
<span id="cb22-26"><a></a>      )</span>
<span id="cb22-27"><a></a>  ) <span class="sc">+</span></span>
<span id="cb22-28"><a></a>  <span class="fu">geom_histogram</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">position =</span> <span class="st">'identity'</span>) <span class="sc">+</span></span>
<span id="cb22-29"><a></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb22-30"><a></a>  <span class="fu">theme</span>(<span class="at">legend.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>), <span class="at">legend.title =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="BSMM_8740_lec_08_files/figure-revealjs/bad ipw estimate plot-1.png" width="960" class="r-stretch"></section>
<section id="doubly-robust-estimation-9" class="slide level2">
<h2>Doubly Robust Estimation</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a></a>dat <span class="sc">|&gt;</span> </span>
<span id="cb23-2"><a></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(method) <span class="sc">|&gt;</span> </span>
<span id="cb23-3"><a></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb23-4"><a></a>  <span class="at">mean =</span> <span class="fu">mean</span>(<span class="st">`</span><span class="at">effect estimate</span><span class="st">`</span>)</span>
<span id="cb23-5"><a></a>  , <span class="at">lower_ci =</span> <span class="fu">quantile</span>(<span class="st">`</span><span class="at">effect estimate</span><span class="st">`</span>, <span class="fl">0.025</span>)</span>
<span id="cb23-6"><a></a>  , <span class="at">upper_ci =</span> <span class="fu">quantile</span>(<span class="st">`</span><span class="at">effect estimate</span><span class="st">`</span>, <span class="fl">0.975</span>)</span>
<span id="cb23-7"><a></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 4
  method                mean lower_ci upper_ci
  &lt;chr&gt;                &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
1 dre_bad_ipw_estimate -12.9    -13.7    -12.2
2 dre_estimate         -12.9    -13.5    -12.3
3 ipw_estimate         -12.6    -13.4    -11.6
4 reg_estimate         -12.4    -12.9    -11.8</code></pre>
</div>
</div>
</section>
<section id="doubly-robust-estimation-10" class="slide level2">
<h2>Doubly Robust Estimation</h2>
<div style="font-size: x-large">
<p>As we can see, messing up the propensity score yields slightly different ATEs, but not by much. This covers the case that the propensity model is wrong but the outcome model is correct. What about the other situation? Let’s again take a good look at the first part of the estimator, but let’s rearrange some terms</p>
<p><span class="math display">\[
\begin{align*}
\hat{E}[Y^{1}] &amp; =\frac{1}{N}\sum\bigg(\dfrac{D_{i}(Y_{i}-\hat{\mu_{1}}(X_{i}))}{\hat{P}(X_{i})}+\hat{\mu_{1}}(X_{i})\bigg)\\
&amp; =\frac{1}{N}\sum\bigg(\dfrac{D_{i}Y_{i}}{\hat{P}(X_{i})}-\dfrac{D_{i}\hat{\mu_{1}}(X_{i})}{\hat{P}(X_{i})}+\hat{\mu_{1}}(X_{i})\bigg)\\
&amp; =\frac{1}{N}\sum\bigg(\dfrac{D_{i}Y_{i}}{\hat{P}(X_{i})}-\bigg(\dfrac{D_{i}}{\hat{P}(X_{i})}-1\bigg)\hat{\mu_{1}}(X_{i})\bigg)\\
&amp; =\frac{1}{N}\sum\bigg(\dfrac{D_{i}Y_{i}}{\hat{P}(X_{i})}-\bigg(\dfrac{D_{i}-\hat{P}(X_{i})}{\hat{P}(X_{i})}\bigg)\hat{\mu_{1}}(X_{i})\bigg)
\end{align*}
\]</span></p>
<p>Now, assume that the propensity score <span class="math inline">\(\hat{P}(X_i)\)</span> is correctly specified. In this case, <span class="math inline">\(E[D_i - \hat{P}(X_i)]=0\)</span>, which wipes out the part dependent on <span class="math inline">\(\hat{\mu_1}(X_i)\)</span>. This makes the doubly robust estimator reduce to the propensity score weighting estimator <span class="math inline">\(\frac{D_iY_i}{\hat{P}(X_i)}\)</span>, which is correct by assumption. So, even if the <span class="math inline">\(\hat{\mu_1}(X_i)\)</span> is wrong, the estimator will still be correct, provided that the propensity score is correctly specified.</p>
</div>
</section>
<section id="doubly-robust-estimation-11" class="slide level2">
<h2>Doubly Robust Estimation</h2>
</section>
<section id="doubly-robust-estimation-12" class="slide level2">
<h2>Doubly Robust Estimation</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a></a>all_results_dat <span class="ot">&lt;-</span> all_results_dat <span class="sc">|&gt;</span></span>
<span id="cb25-2"><a></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb25-3"><a></a>    <span class="at">dre_bad_reg_estimate =</span> </span>
<span id="cb25-4"><a></a>      purrr<span class="sc">::</span><span class="fu">map_dbl</span>(</span>
<span id="cb25-5"><a></a>        splits</span>
<span id="cb25-6"><a></a>        , (\(x){</span>
<span id="cb25-7"><a></a>          <span class="co"># rsample::analysis(x) |&gt; </span></span>
<span id="cb25-8"><a></a>          <span class="co">#   # dplyr::mutate(net = as.numeric(net)) |&gt; # not needed</span></span>
<span id="cb25-9"><a></a>          <span class="co">#   recipes::bake(new_data = rsample::analysis(x)) |&gt; </span></span>
<span id="cb25-10"><a></a>          doubly_robust_rec <span class="sc">|&gt;</span> </span>
<span id="cb25-11"><a></a>            recipes<span class="sc">::</span><span class="fu">bake</span>(<span class="at">new_data =</span> rsample<span class="sc">::</span><span class="fu">analysis</span>(x)) <span class="sc">|&gt;</span> </span>
<span id="cb25-12"><a></a>            <span class="fu">doubly_robust_bad_reg</span>(X, D, Y)</span>
<span id="cb25-13"><a></a>        })</span>
<span id="cb25-14"><a></a>      )</span>
<span id="cb25-15"><a></a>  )</span>
<span id="cb25-16"><a></a></span>
<span id="cb25-17"><a></a>dat <span class="ot">&lt;-</span> all_results_dat <span class="sc">|&gt;</span> </span>
<span id="cb25-18"><a></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb25-19"><a></a>    reg_estimate, ipw_estimate, dre_estimate, dre_bad_ipw_estimate, dre_bad_reg_estimate</span>
<span id="cb25-20"><a></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb25-21"><a></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="at">cols=</span><span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"method"</span>, <span class="at">values_to =</span> <span class="st">"effect estimate"</span>)</span>
<span id="cb25-22"><a></a></span>
<span id="cb25-23"><a></a>dat <span class="sc">|&gt;</span></span>
<span id="cb25-24"><a></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">method=</span><span class="fu">factor</span>(method)) <span class="sc">|&gt;</span></span>
<span id="cb25-25"><a></a>  <span class="fu">ggplot</span>( <span class="at">bins =</span> <span class="dv">50</span>, <span class="at">alpha =</span> .<span class="dv">5</span></span>
<span id="cb25-26"><a></a>    , <span class="fu">aes</span>(</span>
<span id="cb25-27"><a></a>      <span class="st">`</span><span class="at">effect estimate</span><span class="st">`</span>, <span class="fu">after_stat</span>(density) , <span class="at">colour =</span> method, <span class="at">fill =</span> method</span>
<span id="cb25-28"><a></a>      )</span>
<span id="cb25-29"><a></a>  ) <span class="sc">+</span></span>
<span id="cb25-30"><a></a>  <span class="fu">geom_histogram</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">position =</span> <span class="st">'identity'</span>) <span class="sc">+</span></span>
<span id="cb25-31"><a></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="BSMM_8740_lec_08_files/figure-revealjs/bad reg estimate plot-1.png" width="960" class="r-stretch"></section>
<section id="doubly-robust-estimation-13" class="slide level2">
<h2>Doubly Robust Estimation</h2>
<p>Once again, we can use bootstrap and see that the variance is just slightly higher.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a></a>dat <span class="sc">|&gt;</span> </span>
<span id="cb26-2"><a></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(method) <span class="sc">|&gt;</span> </span>
<span id="cb26-3"><a></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb26-4"><a></a>  <span class="at">mean =</span> <span class="fu">mean</span>(<span class="st">`</span><span class="at">effect estimate</span><span class="st">`</span>)</span>
<span id="cb26-5"><a></a>  , <span class="at">lower_ci =</span> <span class="fu">quantile</span>(<span class="st">`</span><span class="at">effect estimate</span><span class="st">`</span>, <span class="fl">0.025</span>)</span>
<span id="cb26-6"><a></a>  , <span class="at">upper_ci =</span> <span class="fu">quantile</span>(<span class="st">`</span><span class="at">effect estimate</span><span class="st">`</span>, <span class="fl">0.975</span>)</span>
<span id="cb26-7"><a></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 4
  method                mean lower_ci upper_ci
  &lt;chr&gt;                &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
1 dre_bad_ipw_estimate -12.9    -13.7    -12.2
2 dre_bad_reg_estimate -12.8    -13.5    -12.0
3 dre_estimate         -12.9    -13.5    -12.3
4 ipw_estimate         -12.6    -13.4    -11.6
5 reg_estimate         -12.4    -12.9    -11.8</code></pre>
</div>
</div>
</section>
<section id="doubly-robust-estimation-14" class="slide level2">
<h2>Doubly Robust Estimation</h2>
<p>Once more, messing up the conditional mean model alone yields only slightly different ATE. The magic of doubly robust estimation happens because in causal inference, there are two ways to remove bias from our causal estimates: you either model the treatment mechanism or the outcome mechanism. If either of these models are correct, you are good to go.</p>
<p>One caveat is that, in practice, it’s very hard to model precisely either of those. More often, what ends up happening is that neither the propensity score nor the outcome model are 100% correct. They are both wrong, but in different ways. When this happens, it is not exactly settled <a href="https://www.stat.cmu.edu/~ryantibs/journalclub/kang_2007.pdf">[1]</a> <a href="https://arxiv.org/pdf/0804.2969.pdf">[2]</a> <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC2798744/">[3]</a> if it’s better to use a single model or doubly robust estimation. I still like using them because at least it gives me two possibilities of being correct.</p>
</section>
<section id="finite-sample-bias" class="slide level2">
<h2>Finite Sample Bias</h2>
<ol type="1">
<li>We know that not accounting for confounders can bias our causal estimates, but it turns out that even after accounting for all confounders, we may still get a biased estimate in finite samples. Many of the properties we tout in statistics rely on large samples—how “large” is defined can be opaque. Let’s look at a quick simulation. Here, we have an exposure/treatment, <span class="math inline">\(X\)</span>, an outcome, <span class="math inline">\(Y\)</span>, and one confounder, <span class="math inline">\(Z\)</span>. We will simulate <span class="math inline">\(Y\)</span>, which is only dependent on <span class="math inline">\(Z\)</span> (so the true treatment effect is 0), and <span class="math inline">\(X\)</span>, which also depends on <span class="math inline">\(Z\)</span>.</li>
</ol>
<p><span class="math display">\[
\begin{align*}
X &amp;\sim \mathscr{N}(0,1)\\
X &amp; = \mathrm{ifelse}(0.5+Z&gt;0,1,0)\\
Y &amp; = Z +  \mathscr{N}(0,1)
\end{align*}
\]</span></p>
</section>
<section id="finite-sample-bias-1" class="slide level2">
<h2>Finite Sample Bias</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a></a><span class="fu">set.seed</span>(<span class="dv">928</span>)</span>
<span id="cb28-2"><a></a>n <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb28-3"><a></a>finite_sample <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb28-4"><a></a>  <span class="co"># z is normally distributed with a mean: 0 and sd: 1</span></span>
<span id="cb28-5"><a></a>  <span class="at">z =</span> <span class="fu">rnorm</span>(n),</span>
<span id="cb28-6"><a></a>  <span class="co"># x is defined from a probit selection model with normally distributed errors</span></span>
<span id="cb28-7"><a></a>  <span class="at">x =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb28-8"><a></a>    <span class="fl">0.5</span> <span class="sc">+</span> z <span class="sc">+</span> <span class="fu">rnorm</span>(n) <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb28-9"><a></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="dv">0</span></span>
<span id="cb28-10"><a></a>  ),</span>
<span id="cb28-11"><a></a>  <span class="co"># y is continuous, dependent only on z with normally distrbuted errors</span></span>
<span id="cb28-12"><a></a>  <span class="at">y =</span> z <span class="sc">+</span> <span class="fu">rnorm</span>(n)</span>
<span id="cb28-13"><a></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="finite-sample-bias-2" class="slide level2">
<h2>Finite Sample Bias</h2>
<p>If we fit a propensity score model using the one confounder <span class="math inline">\(Z\)</span> and calculate the weighted estimator, we should get an unbiased result (which in this case would be <span class="math inline">\(0\)</span>).</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
  effect
   &lt;dbl&gt;
1  0.197</code></pre>
</div>
</div>
</section>
<section id="finite-sample-bias-3" class="slide level2">
<h2>Finite Sample Bias</h2>
<p>Our effect of is pretty far from 0, although it’s hard to know if this is really bias, or something we are just seeing by chance in this particular simulated sample. To explore the potential for finite sample bias, we can rerun this simulation many times at different sample sizes:</p>
</section>
<section id="finite-sample-bias-4" class="slide level2">
<h2>Finite Sample Bias</h2>
<p>Ploting the results:</p>

<img data-src="BSMM_8740_lec_08_files/figure-revealjs/unnamed-chunk-28-1.png" width="960" class="r-stretch quarto-figure-center"><p class="caption">Finite sample bias present with ATE weights created using correctly specified propensity score model, varying the sample size from n = 50 to n = 10,000</p></section>
<section id="finite-sample-bias-5" class="slide level2">
<h2>Finite Sample Bias</h2>
<div style="font-size: x-large">
<p>This is an example of finite sample bias. Notice here, even when the sample size is quite large (5,000) we still see some bias away from the “true” effect of 0. It isn’t until a sample size larger than 10,000 that we see this bias disappear.</p>
<p>Estimands that utilize weights that are unbounded (i.e.&nbsp;that theoretically can be infinitely large) are more likely to suffer from finite sample bias. The likelihood of falling into finite sample bias depends on:</p>
<ol type="1">
<li>the estimand you have chosen (i.e.&nbsp;are the weights bounded?)</li>
<li>the distribution of the covariates in the exposed and unexposed groups (i.e.&nbsp;is there good overlap? Potential positivity violations, when there is poor overlap, are the regions where weights can become too large)</li>
<li>the sample size.</li>
</ol>
</div>
</section>
<section id="matching" class="slide level2">
<h2>Matching</h2>
<p>Regression does an amazing job at controlling for additional variables when we do a test vs control comparison. If we have independence, <span class="math inline">\((Y^0, Y^1)\perp D | X\)</span>, then regression can identify the ATE by controlling for X.</p>
<p>To get some intuition about controlling for X, let’s remember the case when all variables X are dummy variables.</p>
<p>If that is the case, regression partitions the data into the dummy cells and computes the mean difference between test and control. Effectively we are calculating doing <span class="math inline">\(E[Y|D=1] - E[Y|D=0] | X=x]\)</span>, where <span class="math inline">\(x\)</span> is a dummy cell (all dummies set to 1, for example).</p>
<p>Regression then combines the estimate in each of the cells to produce a final ATE. The way it does this is by applying weights to the cell proportional to the variance of the treatment on that group.</p>
</section>
<section id="matching-1" class="slide level2">
<h2>Matching</h2>
<p>To give an example, suppose we try to estimate the effect of a drug and I have 6 men and 4 women. The response variable is days hospitalised and I hope my drug can lower that. On men, the true causal effect is -3, so the drug lowers the stay period by 3 days. On women, it is -2.</p>
<p>To make matters more interesting, men are much more affected by this illness and stay longer at the hospital. They also get much more of the drug. Only 1 out of the 6 men does not get the drug. On the other hand, women are more resistant to this illness, so they stay less at the hospital. 50% of the women get the drug.</p>
<div class="cell">
<div class="cell-output-display">
<div id="uaaskkmbew" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>@import url("https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
#uaaskkmbew table {
  font-family: Lato, system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#uaaskkmbew thead, #uaaskkmbew tbody, #uaaskkmbew tfoot, #uaaskkmbew tr, #uaaskkmbew td, #uaaskkmbew th {
  border-style: none;
}

#uaaskkmbew p {
  margin: 0;
  padding: 0;
}

#uaaskkmbew .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 3px;
  border-top-color: #FFFFFF;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#uaaskkmbew .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#uaaskkmbew .gt_title {
  color: #333333;
  font-size: 24px;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#uaaskkmbew .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#uaaskkmbew .gt_heading {
  background-color: #FFFFFF;
  text-align: left;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#uaaskkmbew .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#uaaskkmbew .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#uaaskkmbew .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#uaaskkmbew .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#uaaskkmbew .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#uaaskkmbew .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#uaaskkmbew .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#uaaskkmbew .gt_spanner_row {
  border-bottom-style: hidden;
}

#uaaskkmbew .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#uaaskkmbew .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#uaaskkmbew .gt_from_md > :first-child {
  margin-top: 0;
}

#uaaskkmbew .gt_from_md > :last-child {
  margin-bottom: 0;
}

#uaaskkmbew .gt_row {
  padding-top: 7px;
  padding-bottom: 7px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #F6F7F7;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#uaaskkmbew .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#uaaskkmbew .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#uaaskkmbew .gt_row_group_first td {
  border-top-width: 2px;
}

#uaaskkmbew .gt_row_group_first th {
  border-top-width: 2px;
}

#uaaskkmbew .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#uaaskkmbew .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#uaaskkmbew .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#uaaskkmbew .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#uaaskkmbew .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#uaaskkmbew .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#uaaskkmbew .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#uaaskkmbew .gt_striped {
  background-color: #FAFAFA;
}

#uaaskkmbew .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#uaaskkmbew .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#uaaskkmbew .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#uaaskkmbew .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#uaaskkmbew .gt_sourcenote {
  font-size: 12px;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#uaaskkmbew .gt_left {
  text-align: left;
}

#uaaskkmbew .gt_center {
  text-align: center;
}

#uaaskkmbew .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#uaaskkmbew .gt_font_normal {
  font-weight: normal;
}

#uaaskkmbew .gt_font_bold {
  font-weight: bold;
}

#uaaskkmbew .gt_font_italic {
  font-style: italic;
}

#uaaskkmbew .gt_super {
  font-size: 65%;
}

#uaaskkmbew .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#uaaskkmbew .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#uaaskkmbew .gt_indent_1 {
  text-indent: 5px;
}

#uaaskkmbew .gt_indent_2 {
  text-indent: 10px;
}

#uaaskkmbew .gt_indent_3 {
  text-indent: 15px;
}

#uaaskkmbew .gt_indent_4 {
  text-indent: 20px;
}

#uaaskkmbew .gt_indent_5 {
  text-indent: 25px;
}

#uaaskkmbew .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#uaaskkmbew div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_col_headings">
<th id="sex" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">sex</th>
<th id="drug" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">drug</th>
<th id="days" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">days</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="sex">M</td>
<td class="gt_row gt_right" headers="drug">1</td>
<td class="gt_row gt_right" headers="days">5</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_striped" headers="sex">M</td>
<td class="gt_row gt_right gt_striped" headers="drug">1</td>
<td class="gt_row gt_right gt_striped" headers="days">5</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="sex">M</td>
<td class="gt_row gt_right" headers="drug">1</td>
<td class="gt_row gt_right" headers="days">5</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_striped" headers="sex">M</td>
<td class="gt_row gt_right gt_striped" headers="drug">1</td>
<td class="gt_row gt_right gt_striped" headers="days">5</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="sex">M</td>
<td class="gt_row gt_right" headers="drug">1</td>
<td class="gt_row gt_right" headers="days">5</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_striped" headers="sex">M</td>
<td class="gt_row gt_right gt_striped" headers="drug">0</td>
<td class="gt_row gt_right gt_striped" headers="days">8</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="sex">W</td>
<td class="gt_row gt_right" headers="drug">1</td>
<td class="gt_row gt_right" headers="days">2</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_striped" headers="sex">W</td>
<td class="gt_row gt_right gt_striped" headers="drug">0</td>
<td class="gt_row gt_right gt_striped" headers="days">4</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="sex">W</td>
<td class="gt_row gt_right" headers="drug">1</td>
<td class="gt_row gt_right" headers="days">2</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_striped" headers="sex">W</td>
<td class="gt_row gt_right gt_striped" headers="drug">0</td>
<td class="gt_row gt_right gt_striped" headers="days">4</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="matching-2" class="slide level2">
<h2>Matching</h2>
<p>Note that simple comparison of treatment and control yields a negatively biased effect, that is, the drug seems less effective than it truly is. This is expected, since we’ve omitted the sex confounder. In this case, the estimated ATE is smaller than the true one because men get more of the drug and are more affected by the illness.</p>
<div class="cell">
<div class="cell-output-display">
<div id="kyuiqrqycx" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>@import url("https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
#kyuiqrqycx table {
  font-family: Lato, system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#kyuiqrqycx thead, #kyuiqrqycx tbody, #kyuiqrqycx tfoot, #kyuiqrqycx tr, #kyuiqrqycx td, #kyuiqrqycx th {
  border-style: none;
}

#kyuiqrqycx p {
  margin: 0;
  padding: 0;
}

#kyuiqrqycx .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 3px;
  border-top-color: #FFFFFF;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#kyuiqrqycx .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#kyuiqrqycx .gt_title {
  color: #333333;
  font-size: 24px;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#kyuiqrqycx .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#kyuiqrqycx .gt_heading {
  background-color: #FFFFFF;
  text-align: left;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#kyuiqrqycx .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#kyuiqrqycx .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#kyuiqrqycx .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#kyuiqrqycx .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#kyuiqrqycx .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#kyuiqrqycx .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#kyuiqrqycx .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#kyuiqrqycx .gt_spanner_row {
  border-bottom-style: hidden;
}

#kyuiqrqycx .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#kyuiqrqycx .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#kyuiqrqycx .gt_from_md > :first-child {
  margin-top: 0;
}

#kyuiqrqycx .gt_from_md > :last-child {
  margin-bottom: 0;
}

#kyuiqrqycx .gt_row {
  padding-top: 7px;
  padding-bottom: 7px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #F6F7F7;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#kyuiqrqycx .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#kyuiqrqycx .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#kyuiqrqycx .gt_row_group_first td {
  border-top-width: 2px;
}

#kyuiqrqycx .gt_row_group_first th {
  border-top-width: 2px;
}

#kyuiqrqycx .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#kyuiqrqycx .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#kyuiqrqycx .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#kyuiqrqycx .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#kyuiqrqycx .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#kyuiqrqycx .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#kyuiqrqycx .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#kyuiqrqycx .gt_striped {
  background-color: #FAFAFA;
}

#kyuiqrqycx .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#kyuiqrqycx .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#kyuiqrqycx .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#kyuiqrqycx .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#kyuiqrqycx .gt_sourcenote {
  font-size: 12px;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#kyuiqrqycx .gt_left {
  text-align: left;
}

#kyuiqrqycx .gt_center {
  text-align: center;
}

#kyuiqrqycx .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#kyuiqrqycx .gt_font_normal {
  font-weight: normal;
}

#kyuiqrqycx .gt_font_bold {
  font-weight: bold;
}

#kyuiqrqycx .gt_font_italic {
  font-style: italic;
}

#kyuiqrqycx .gt_super {
  font-size: 65%;
}

#kyuiqrqycx .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#kyuiqrqycx .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#kyuiqrqycx .gt_indent_1 {
  text-indent: 5px;
}

#kyuiqrqycx .gt_indent_2 {
  text-indent: 10px;
}

#kyuiqrqycx .gt_indent_3 {
  text-indent: 15px;
}

#kyuiqrqycx .gt_indent_4 {
  text-indent: 20px;
}

#kyuiqrqycx .gt_indent_5 {
  text-indent: 25px;
}

#kyuiqrqycx .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#kyuiqrqycx div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_col_headings">
<th id="drug" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">drug</th>
<th id="mean_effect" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">mean_effect</th>
<th id="ATE" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">ATE</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_right" headers="drug">0</td>
<td class="gt_row gt_right" headers="mean_effect">5.333</td>
<td class="gt_row gt_right" headers="ATE">NA</td>
</tr>
<tr class="even">
<td class="gt_row gt_right gt_striped" headers="drug">1</td>
<td class="gt_row gt_right gt_striped" headers="mean_effect">4.143</td>
<td class="gt_row gt_right gt_striped" headers="ATE">-1.19</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="matching-3" class="slide level2">
<h2>Matching</h2>
<p>Since the true effect for men is -3 and the true effect for women is -2, the ATE should be</p>
<p><span class="math display">\[
ATE=\dfrac{(-3*6) + (-2*4)}{10}=-2.6
\]</span></p>
<p>This estimate is done by</p>
<ol type="1">
<li>partitioning the data into confounder cells, in this case, men and women,</li>
<li>estimating the effect on each cell and</li>
<li>combining the estimate with a weighted average, where the weight is the sample size of the cell or covariate group.</li>
</ol>
</section>
<section id="matching-4" class="slide level2">
<h2>Matching</h2>
<p>If we had exactly the same number of men and women in the data, the ATE estimate would be right in the middle of the ATE of the 2 groups, -2.5. Since there are more men than women in our dataset, the ATE estimate is a little bit closer to the men’s ATE. This is called a non-parametric estimate, since it places no assumption on how the data was generated.</p>
<p>If we control for sex using regression, we will add the assumption of linearity. Regression will also partition the data into men and women and estimate the effect on both of these groups. So far, so good. However, when it comes to combining the effect on each group, it does not weigh them by the sample size.</p>
</section>
<section id="matching-5" class="slide level2">
<h2>Matching</h2>
<p>Instead, regression uses weights that are proportional to the variance of the treatment in that group. In our case, the variance of the treatment in men is smaller than in women, since only one man is in the control group. To be exact, the variance of D for men is <span class="math inline">\(0.139=1/6*(1 - 1/6)\)</span> and for women is <span class="math inline">\(0.25=2/4*(1 - 2/4)\)</span>. So regression will give a higher weight to women in our example and the ATE will be a bit closer to the women’s ATE of -2.</p>
<div class="cell">
<div class="cell-output-display">
<div id="kgmohzmjrw" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>@import url("https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
#kgmohzmjrw table {
  font-family: Lato, system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#kgmohzmjrw thead, #kgmohzmjrw tbody, #kgmohzmjrw tfoot, #kgmohzmjrw tr, #kgmohzmjrw td, #kgmohzmjrw th {
  border-style: none;
}

#kgmohzmjrw p {
  margin: 0;
  padding: 0;
}

#kgmohzmjrw .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 3px;
  border-top-color: #FFFFFF;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#kgmohzmjrw .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#kgmohzmjrw .gt_title {
  color: #333333;
  font-size: 24px;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#kgmohzmjrw .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#kgmohzmjrw .gt_heading {
  background-color: #FFFFFF;
  text-align: left;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#kgmohzmjrw .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#kgmohzmjrw .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#kgmohzmjrw .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#kgmohzmjrw .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#kgmohzmjrw .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#kgmohzmjrw .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#kgmohzmjrw .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#kgmohzmjrw .gt_spanner_row {
  border-bottom-style: hidden;
}

#kgmohzmjrw .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#kgmohzmjrw .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#kgmohzmjrw .gt_from_md > :first-child {
  margin-top: 0;
}

#kgmohzmjrw .gt_from_md > :last-child {
  margin-bottom: 0;
}

#kgmohzmjrw .gt_row {
  padding-top: 7px;
  padding-bottom: 7px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #F6F7F7;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#kgmohzmjrw .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#kgmohzmjrw .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#kgmohzmjrw .gt_row_group_first td {
  border-top-width: 2px;
}

#kgmohzmjrw .gt_row_group_first th {
  border-top-width: 2px;
}

#kgmohzmjrw .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#kgmohzmjrw .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#kgmohzmjrw .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#kgmohzmjrw .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#kgmohzmjrw .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#kgmohzmjrw .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#kgmohzmjrw .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#kgmohzmjrw .gt_striped {
  background-color: #FAFAFA;
}

#kgmohzmjrw .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#kgmohzmjrw .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#kgmohzmjrw .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#kgmohzmjrw .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#kgmohzmjrw .gt_sourcenote {
  font-size: 12px;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#kgmohzmjrw .gt_left {
  text-align: left;
}

#kgmohzmjrw .gt_center {
  text-align: center;
}

#kgmohzmjrw .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#kgmohzmjrw .gt_font_normal {
  font-weight: normal;
}

#kgmohzmjrw .gt_font_bold {
  font-weight: bold;
}

#kgmohzmjrw .gt_font_italic {
  font-style: italic;
}

#kgmohzmjrw .gt_super {
  font-size: 65%;
}

#kgmohzmjrw .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#kgmohzmjrw .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#kgmohzmjrw .gt_indent_1 {
  text-indent: 5px;
}

#kgmohzmjrw .gt_indent_2 {
  text-indent: 10px;
}

#kgmohzmjrw .gt_indent_3 {
  text-indent: 15px;
}

#kgmohzmjrw .gt_indent_4 {
  text-indent: 20px;
}

#kgmohzmjrw .gt_indent_5 {
  text-indent: 25px;
}

#kgmohzmjrw .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#kgmohzmjrw div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_heading">
<th colspan="5" class="gt_heading gt_title gt_font_normal">Regression summary (ATE)</th>
</tr>
<tr class="odd gt_heading">
<th colspan="5" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border">days ~ drug + sex</th>
</tr>
<tr class="header gt_col_headings">
<th id="term" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">term</th>
<th id="estimate" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">estimate</th>
<th id="std.error" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">std.error</th>
<th id="statistic" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">statistic</th>
<th id="p.value" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">p.value</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="term">(Intercept)</td>
<td class="gt_row gt_right" headers="estimate">7.5455</td>
<td class="gt_row gt_right" headers="std.error">0.188</td>
<td class="gt_row gt_right" headers="statistic">40.093</td>
<td class="gt_row gt_right" headers="p.value">0.000</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_striped" headers="term">drug</td>
<td class="gt_row gt_right gt_striped" headers="estimate">−2.4545</td>
<td class="gt_row gt_right gt_striped" headers="std.error">0.188</td>
<td class="gt_row gt_right gt_striped" headers="statistic">−13.042</td>
<td class="gt_row gt_right gt_striped" headers="p.value">0.000</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="term">sexW</td>
<td class="gt_row gt_right" headers="estimate">−3.3182</td>
<td class="gt_row gt_right" headers="std.error">0.176</td>
<td class="gt_row gt_right" headers="statistic">−18.849</td>
<td class="gt_row gt_right" headers="p.value">0.000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="matching-6" class="slide level2">
<h2>Matching</h2>
<p>The result is more intuitive with dummy variables, but regression also keeps continuous variables constant while estimating the effect. Also with continuous variables, the ATE will point in the direction where covariates have more variance.</p>
<p>So we’ve seen that regression has its idiosyncrasies. It is linear, parametric, likes high variance features… This can be good or bad, depending on the context. Because of this, it’s important to be aware of other techniques we can use to control for confounders. Not only are they an extra tool in your causal tool belt, but understanding different ways to deal with confounding expands our understanding of the problem. For this reason, I present you now the Subclassification Estimator!</p>
</section>
<section id="matching-subclassification" class="slide level2">
<h2>Matching: subclassification</h2>
<p>In general, if there is some causal effect we want to estimate, but it is hard to do so because of confounding of some variables X, what we need to do is make the treatment vs control comparison within small groups where X is the same. If we have conditional independence <span class="math inline">\((Y^0, Y^1)\perp D | X\)</span> , then we can write the ATE as follows.</p>
<p><span class="math display">\[
ATE = \int(E[Y|X, D=1] - E[Y|X, D=0])dP(x)
\]</span></p>
</section>
<section id="matching-subclassification-1" class="slide level2">
<h2>Matching: subclassification</h2>
<p>What the integral does is it goes through all the space of the distribution of features X, computes the difference in means for all those tiny spaces and combines everything into the ATE.</p>
<p>Another way to see this is to think about a discrete set of features. In this case, we can say that the features X takes on K different cells <span class="math inline">\(\{X_1, X_2, ..., X_k\}\)</span> and what we are doing is computing the treatment effect in each cell and combining them into the ATE. In this discrete case, converting the integral to a sum, we can derive the subclassifications estimator</p>
<p><span class="math display">\[
\hat{ATE} = \sum^K_{k=1}(\bar{Y}^1_k - \bar{Y}^0_k) * \dfrac{N_k}{N}
\]</span></p>
</section>
<section id="matching-subclassification-2" class="slide level2">
<h2>Matching: subclassification</h2>
<p><span class="math display">\[
\hat{ATE} = \sum^K_{k=1}(\bar{Y}^1_k - \bar{Y}^0_k) * \dfrac{N_k}{N}
\]</span></p>
<p>As you can see, we are computing a local ATE for each cell and combining them using a weighted average, where the weights are the sample size of the cell. In our medicine example above, this would be the first estimate, which gave us −2.6.</p>
<p>The subclassification estimator isn’t used much in practice, because of the curse of dimensionality.</p>
</section>
<section id="matching-estimator" class="slide level2">
<h2>Matching estimator</h2>
<p>The subclassification estimator gives us a nice intuition of what a causal inference estimator should do, how it should control for confounders. This allows us to explore other kinds of estimators, such as the Matching Estimator.</p>
</section>
<section id="matching-estimator-1" class="slide level2">
<h2>Matching estimator</h2>
<p>Since some confounder X makes it so that treated and untreated are not initially comparable, I can make them so by matching each treated unit with a similar untreated unit. It is like we’re finding an untreated twin for every treated unit. By making such comparisons, treated and untreated become again comparable.</p>
<p>As an example, let’s suppose we are trying to estimate the effect of a trainee program on earnings. Here is what the trainees looks like</p>
<div class="panel-tabset">
<ul id="tabset-2" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-2-1">trainees</a></li><li><a href="#tabset-2-2">non trainees</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1">
<div class="cell">
<div class="cell-output-display">
<div id="mduhivknhv" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>@import url("https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
#mduhivknhv table {
  font-family: Lato, system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#mduhivknhv thead, #mduhivknhv tbody, #mduhivknhv tfoot, #mduhivknhv tr, #mduhivknhv td, #mduhivknhv th {
  border-style: none;
}

#mduhivknhv p {
  margin: 0;
  padding: 0;
}

#mduhivknhv .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 3px;
  border-top-color: #FFFFFF;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#mduhivknhv .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#mduhivknhv .gt_title {
  color: #333333;
  font-size: 24px;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#mduhivknhv .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#mduhivknhv .gt_heading {
  background-color: #FFFFFF;
  text-align: left;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#mduhivknhv .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#mduhivknhv .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#mduhivknhv .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#mduhivknhv .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#mduhivknhv .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#mduhivknhv .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#mduhivknhv .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#mduhivknhv .gt_spanner_row {
  border-bottom-style: hidden;
}

#mduhivknhv .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#mduhivknhv .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#mduhivknhv .gt_from_md > :first-child {
  margin-top: 0;
}

#mduhivknhv .gt_from_md > :last-child {
  margin-bottom: 0;
}

#mduhivknhv .gt_row {
  padding-top: 7px;
  padding-bottom: 7px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #F6F7F7;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#mduhivknhv .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#mduhivknhv .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#mduhivknhv .gt_row_group_first td {
  border-top-width: 2px;
}

#mduhivknhv .gt_row_group_first th {
  border-top-width: 2px;
}

#mduhivknhv .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#mduhivknhv .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#mduhivknhv .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#mduhivknhv .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#mduhivknhv .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#mduhivknhv .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#mduhivknhv .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#mduhivknhv .gt_striped {
  background-color: #FAFAFA;
}

#mduhivknhv .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#mduhivknhv .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#mduhivknhv .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#mduhivknhv .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#mduhivknhv .gt_sourcenote {
  font-size: 12px;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#mduhivknhv .gt_left {
  text-align: left;
}

#mduhivknhv .gt_center {
  text-align: center;
}

#mduhivknhv .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#mduhivknhv .gt_font_normal {
  font-weight: normal;
}

#mduhivknhv .gt_font_bold {
  font-weight: bold;
}

#mduhivknhv .gt_font_italic {
  font-style: italic;
}

#mduhivknhv .gt_super {
  font-size: 65%;
}

#mduhivknhv .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#mduhivknhv .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#mduhivknhv .gt_indent_1 {
  text-indent: 5px;
}

#mduhivknhv .gt_indent_2 {
  text-indent: 10px;
}

#mduhivknhv .gt_indent_3 {
  text-indent: 15px;
}

#mduhivknhv .gt_indent_4 {
  text-indent: 20px;
}

#mduhivknhv .gt_indent_5 {
  text-indent: 25px;
}

#mduhivknhv .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#mduhivknhv div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_col_headings">
<th id="unit" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">unit</th>
<th id="trainees" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">trainees</th>
<th id="age" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">age</th>
<th id="earnings" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">earnings</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_right" headers="unit">1</td>
<td class="gt_row gt_right" headers="trainees">1</td>
<td class="gt_row gt_right" headers="age">28</td>
<td class="gt_row gt_right" headers="earnings">17700</td>
</tr>
<tr class="even">
<td class="gt_row gt_right gt_striped" headers="unit">2</td>
<td class="gt_row gt_right gt_striped" headers="trainees">1</td>
<td class="gt_row gt_right gt_striped" headers="age">34</td>
<td class="gt_row gt_right gt_striped" headers="earnings">10200</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="unit">3</td>
<td class="gt_row gt_right" headers="trainees">1</td>
<td class="gt_row gt_right" headers="age">29</td>
<td class="gt_row gt_right" headers="earnings">14400</td>
</tr>
<tr class="even">
<td class="gt_row gt_right gt_striped" headers="unit">4</td>
<td class="gt_row gt_right gt_striped" headers="trainees">1</td>
<td class="gt_row gt_right gt_striped" headers="age">25</td>
<td class="gt_row gt_right gt_striped" headers="earnings">20800</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="unit">5</td>
<td class="gt_row gt_right" headers="trainees">1</td>
<td class="gt_row gt_right" headers="age">29</td>
<td class="gt_row gt_right" headers="earnings">6100</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<div id="tabset-2-2">
<div class="cell">
<div class="cell-output-display">
<div id="edgwgjaxri" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>@import url("https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
#edgwgjaxri table {
  font-family: Lato, system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#edgwgjaxri thead, #edgwgjaxri tbody, #edgwgjaxri tfoot, #edgwgjaxri tr, #edgwgjaxri td, #edgwgjaxri th {
  border-style: none;
}

#edgwgjaxri p {
  margin: 0;
  padding: 0;
}

#edgwgjaxri .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 3px;
  border-top-color: #FFFFFF;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#edgwgjaxri .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#edgwgjaxri .gt_title {
  color: #333333;
  font-size: 24px;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#edgwgjaxri .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#edgwgjaxri .gt_heading {
  background-color: #FFFFFF;
  text-align: left;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#edgwgjaxri .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#edgwgjaxri .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#edgwgjaxri .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#edgwgjaxri .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#edgwgjaxri .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#edgwgjaxri .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#edgwgjaxri .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#edgwgjaxri .gt_spanner_row {
  border-bottom-style: hidden;
}

#edgwgjaxri .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#edgwgjaxri .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#edgwgjaxri .gt_from_md > :first-child {
  margin-top: 0;
}

#edgwgjaxri .gt_from_md > :last-child {
  margin-bottom: 0;
}

#edgwgjaxri .gt_row {
  padding-top: 7px;
  padding-bottom: 7px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #F6F7F7;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#edgwgjaxri .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#edgwgjaxri .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#edgwgjaxri .gt_row_group_first td {
  border-top-width: 2px;
}

#edgwgjaxri .gt_row_group_first th {
  border-top-width: 2px;
}

#edgwgjaxri .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#edgwgjaxri .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#edgwgjaxri .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#edgwgjaxri .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#edgwgjaxri .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#edgwgjaxri .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#edgwgjaxri .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#edgwgjaxri .gt_striped {
  background-color: #FAFAFA;
}

#edgwgjaxri .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#edgwgjaxri .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#edgwgjaxri .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#edgwgjaxri .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#edgwgjaxri .gt_sourcenote {
  font-size: 12px;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#edgwgjaxri .gt_left {
  text-align: left;
}

#edgwgjaxri .gt_center {
  text-align: center;
}

#edgwgjaxri .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#edgwgjaxri .gt_font_normal {
  font-weight: normal;
}

#edgwgjaxri .gt_font_bold {
  font-weight: bold;
}

#edgwgjaxri .gt_font_italic {
  font-style: italic;
}

#edgwgjaxri .gt_super {
  font-size: 65%;
}

#edgwgjaxri .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#edgwgjaxri .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#edgwgjaxri .gt_indent_1 {
  text-indent: 5px;
}

#edgwgjaxri .gt_indent_2 {
  text-indent: 10px;
}

#edgwgjaxri .gt_indent_3 {
  text-indent: 15px;
}

#edgwgjaxri .gt_indent_4 {
  text-indent: 20px;
}

#edgwgjaxri .gt_indent_5 {
  text-indent: 25px;
}

#edgwgjaxri .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#edgwgjaxri div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_col_headings">
<th id="unit" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">unit</th>
<th id="trainees" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">trainees</th>
<th id="age" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">age</th>
<th id="earnings" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">earnings</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_right" headers="unit">20</td>
<td class="gt_row gt_right" headers="trainees">0</td>
<td class="gt_row gt_right" headers="age">43</td>
<td class="gt_row gt_right" headers="earnings">20900</td>
</tr>
<tr class="even">
<td class="gt_row gt_right gt_striped" headers="unit">21</td>
<td class="gt_row gt_right gt_striped" headers="trainees">0</td>
<td class="gt_row gt_right gt_striped" headers="age">50</td>
<td class="gt_row gt_right gt_striped" headers="earnings">31000</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="unit">22</td>
<td class="gt_row gt_right" headers="trainees">0</td>
<td class="gt_row gt_right" headers="age">30</td>
<td class="gt_row gt_right" headers="earnings">21000</td>
</tr>
<tr class="even">
<td class="gt_row gt_right gt_striped" headers="unit">23</td>
<td class="gt_row gt_right gt_striped" headers="trainees">0</td>
<td class="gt_row gt_right gt_striped" headers="age">27</td>
<td class="gt_row gt_right gt_striped" headers="earnings">9300</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="unit">24</td>
<td class="gt_row gt_right" headers="trainees">0</td>
<td class="gt_row gt_right" headers="age">54</td>
<td class="gt_row gt_right" headers="earnings">41100</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="matching-estimator-2" class="slide level2">
<h2>Matching estimator</h2>
<p>A simple comparison in means, identifies that the trainees earn less money than those that didn’t go through the program.</p>
<div class="cell">
<div class="cell-output-display">
<div id="hzjsgpcyxm" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>@import url("https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
#hzjsgpcyxm table {
  font-family: Lato, system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#hzjsgpcyxm thead, #hzjsgpcyxm tbody, #hzjsgpcyxm tfoot, #hzjsgpcyxm tr, #hzjsgpcyxm td, #hzjsgpcyxm th {
  border-style: none;
}

#hzjsgpcyxm p {
  margin: 0;
  padding: 0;
}

#hzjsgpcyxm .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 3px;
  border-top-color: #FFFFFF;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#hzjsgpcyxm .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#hzjsgpcyxm .gt_title {
  color: #333333;
  font-size: 24px;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#hzjsgpcyxm .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#hzjsgpcyxm .gt_heading {
  background-color: #FFFFFF;
  text-align: left;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#hzjsgpcyxm .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hzjsgpcyxm .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#hzjsgpcyxm .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#hzjsgpcyxm .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#hzjsgpcyxm .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#hzjsgpcyxm .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#hzjsgpcyxm .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#hzjsgpcyxm .gt_spanner_row {
  border-bottom-style: hidden;
}

#hzjsgpcyxm .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#hzjsgpcyxm .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#hzjsgpcyxm .gt_from_md > :first-child {
  margin-top: 0;
}

#hzjsgpcyxm .gt_from_md > :last-child {
  margin-bottom: 0;
}

#hzjsgpcyxm .gt_row {
  padding-top: 7px;
  padding-bottom: 7px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #F6F7F7;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#hzjsgpcyxm .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#hzjsgpcyxm .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#hzjsgpcyxm .gt_row_group_first td {
  border-top-width: 2px;
}

#hzjsgpcyxm .gt_row_group_first th {
  border-top-width: 2px;
}

#hzjsgpcyxm .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#hzjsgpcyxm .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#hzjsgpcyxm .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#hzjsgpcyxm .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hzjsgpcyxm .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#hzjsgpcyxm .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#hzjsgpcyxm .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#hzjsgpcyxm .gt_striped {
  background-color: #FAFAFA;
}

#hzjsgpcyxm .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hzjsgpcyxm .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#hzjsgpcyxm .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#hzjsgpcyxm .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#hzjsgpcyxm .gt_sourcenote {
  font-size: 12px;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#hzjsgpcyxm .gt_left {
  text-align: left;
}

#hzjsgpcyxm .gt_center {
  text-align: center;
}

#hzjsgpcyxm .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#hzjsgpcyxm .gt_font_normal {
  font-weight: normal;
}

#hzjsgpcyxm .gt_font_bold {
  font-weight: bold;
}

#hzjsgpcyxm .gt_font_italic {
  font-style: italic;
}

#hzjsgpcyxm .gt_super {
  font-size: 65%;
}

#hzjsgpcyxm .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#hzjsgpcyxm .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#hzjsgpcyxm .gt_indent_1 {
  text-indent: 5px;
}

#hzjsgpcyxm .gt_indent_2 {
  text-indent: 10px;
}

#hzjsgpcyxm .gt_indent_3 {
  text-indent: 15px;
}

#hzjsgpcyxm .gt_indent_4 {
  text-indent: 20px;
}

#hzjsgpcyxm .gt_indent_5 {
  text-indent: 25px;
}

#hzjsgpcyxm .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#hzjsgpcyxm div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_col_headings">
<th id="trainees" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">trainees</th>
<th id="mean_effect" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">mean_effect</th>
<th id="ATE" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">ATE</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_right" headers="trainees">0</td>
<td class="gt_row gt_right" headers="mean_effect">20724</td>
<td class="gt_row gt_right" headers="ATE">NA</td>
</tr>
<tr class="even">
<td class="gt_row gt_right gt_striped" headers="trainees">1</td>
<td class="gt_row gt_right gt_striped" headers="mean_effect">16426</td>
<td class="gt_row gt_right gt_striped" headers="ATE">-4297</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="matching-estimator-3" class="slide level2">
<h2>Matching estimator</h2>
<p>However, if we look at the data tables, we notice that trainees are much younger than non trainees, which indicates that age is probably a confounder.</p>
<p>We can use matching on age to try to correct that. We will take unit 1 from the treated and pair it with unit 27, since both are 28 years old. Unit 2 we will pair it with unit 34, unit 3 with unit 37, unit 4 we will pair it with unit 35… When it comes to unit 5, we need to find someone with age 29 from the non treated, but that is unit 37, which is already paired. This is not a problem, since we can use the same unit multiple times. If more than 1 unit is a match, we can choose randomly between them.</p>
<div class="cell">
<div class="cell-output-display">
<div id="dicxhclvix" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>@import url("https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
#dicxhclvix table {
  font-family: Lato, system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#dicxhclvix thead, #dicxhclvix tbody, #dicxhclvix tfoot, #dicxhclvix tr, #dicxhclvix td, #dicxhclvix th {
  border-style: none;
}

#dicxhclvix p {
  margin: 0;
  padding: 0;
}

#dicxhclvix .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 3px;
  border-top-color: #FFFFFF;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#dicxhclvix .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#dicxhclvix .gt_title {
  color: #333333;
  font-size: 24px;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#dicxhclvix .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#dicxhclvix .gt_heading {
  background-color: #FFFFFF;
  text-align: left;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#dicxhclvix .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#dicxhclvix .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#dicxhclvix .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#dicxhclvix .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#dicxhclvix .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#dicxhclvix .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#dicxhclvix .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#dicxhclvix .gt_spanner_row {
  border-bottom-style: hidden;
}

#dicxhclvix .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#dicxhclvix .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#dicxhclvix .gt_from_md > :first-child {
  margin-top: 0;
}

#dicxhclvix .gt_from_md > :last-child {
  margin-bottom: 0;
}

#dicxhclvix .gt_row {
  padding-top: 7px;
  padding-bottom: 7px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #F6F7F7;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#dicxhclvix .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#dicxhclvix .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#dicxhclvix .gt_row_group_first td {
  border-top-width: 2px;
}

#dicxhclvix .gt_row_group_first th {
  border-top-width: 2px;
}

#dicxhclvix .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#dicxhclvix .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#dicxhclvix .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#dicxhclvix .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#dicxhclvix .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#dicxhclvix .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#dicxhclvix .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#dicxhclvix .gt_striped {
  background-color: #FAFAFA;
}

#dicxhclvix .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#dicxhclvix .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#dicxhclvix .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#dicxhclvix .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#dicxhclvix .gt_sourcenote {
  font-size: 12px;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#dicxhclvix .gt_left {
  text-align: left;
}

#dicxhclvix .gt_center {
  text-align: center;
}

#dicxhclvix .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#dicxhclvix .gt_font_normal {
  font-weight: normal;
}

#dicxhclvix .gt_font_bold {
  font-weight: bold;
}

#dicxhclvix .gt_font_italic {
  font-style: italic;
}

#dicxhclvix .gt_super {
  font-size: 65%;
}

#dicxhclvix .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#dicxhclvix .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#dicxhclvix .gt_indent_1 {
  text-indent: 5px;
}

#dicxhclvix .gt_indent_2 {
  text-indent: 10px;
}

#dicxhclvix .gt_indent_3 {
  text-indent: 15px;
}

#dicxhclvix .gt_indent_4 {
  text-indent: 20px;
}

#dicxhclvix .gt_indent_5 {
  text-indent: 25px;
}

#dicxhclvix .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#dicxhclvix div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_col_headings">
<th id="unit_t_1" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">unit_t_1</th>
<th id="trainees_t_1" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">trainees_t_1</th>
<th id="age" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">age</th>
<th id="earnings_t_1" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">earnings_t_1</th>
<th id="unit_t_0" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">unit_t_0</th>
<th id="trainees_t_0" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">trainees_t_0</th>
<th id="earnings_t_0" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">earnings_t_0</th>
<th id="t1_minus_t0" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">t1_minus_t0</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_right" headers="unit_t_1">1</td>
<td class="gt_row gt_right" headers="trainees_t_1">1</td>
<td class="gt_row gt_right" headers="age">28</td>
<td class="gt_row gt_right" headers="earnings_t_1">17700</td>
<td class="gt_row gt_right" headers="unit_t_0">27</td>
<td class="gt_row gt_right" headers="trainees_t_0">0</td>
<td class="gt_row gt_right" headers="earnings_t_0">8800</td>
<td class="gt_row gt_right" headers="t1_minus_t0">8900</td>
</tr>
<tr class="even">
<td class="gt_row gt_right gt_striped" headers="unit_t_1">2</td>
<td class="gt_row gt_right gt_striped" headers="trainees_t_1">1</td>
<td class="gt_row gt_right gt_striped" headers="age">34</td>
<td class="gt_row gt_right gt_striped" headers="earnings_t_1">10200</td>
<td class="gt_row gt_right gt_striped" headers="unit_t_0">34</td>
<td class="gt_row gt_right gt_striped" headers="trainees_t_0">0</td>
<td class="gt_row gt_right gt_striped" headers="earnings_t_0">24200</td>
<td class="gt_row gt_right gt_striped" headers="t1_minus_t0">-14000</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="unit_t_1">3</td>
<td class="gt_row gt_right" headers="trainees_t_1">1</td>
<td class="gt_row gt_right" headers="age">29</td>
<td class="gt_row gt_right" headers="earnings_t_1">14400</td>
<td class="gt_row gt_right" headers="unit_t_0">37</td>
<td class="gt_row gt_right" headers="trainees_t_0">0</td>
<td class="gt_row gt_right" headers="earnings_t_0">6200</td>
<td class="gt_row gt_right" headers="t1_minus_t0">8200</td>
</tr>
<tr class="even">
<td class="gt_row gt_right gt_striped" headers="unit_t_1">4</td>
<td class="gt_row gt_right gt_striped" headers="trainees_t_1">1</td>
<td class="gt_row gt_right gt_striped" headers="age">25</td>
<td class="gt_row gt_right gt_striped" headers="earnings_t_1">20800</td>
<td class="gt_row gt_right gt_striped" headers="unit_t_0">35</td>
<td class="gt_row gt_right gt_striped" headers="trainees_t_0">0</td>
<td class="gt_row gt_right gt_striped" headers="earnings_t_0">23300</td>
<td class="gt_row gt_right gt_striped" headers="t1_minus_t0">-2500</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="unit_t_1">5</td>
<td class="gt_row gt_right" headers="trainees_t_1">1</td>
<td class="gt_row gt_right" headers="age">29</td>
<td class="gt_row gt_right" headers="earnings_t_1">6100</td>
<td class="gt_row gt_right" headers="unit_t_0">37</td>
<td class="gt_row gt_right" headers="trainees_t_0">0</td>
<td class="gt_row gt_right" headers="earnings_t_0">6200</td>
<td class="gt_row gt_right" headers="t1_minus_t0">-100</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="matching-estimator-4" class="slide level2">
<h2>Matching estimator</h2>
<p>If we take the mean of this last column we get the ATET estimate while controlling for age. Notice how the estimate is now very positive, compared to the previous one where we used a simple difference in means.</p>
<div class="cell">
<div class="cell-output-display">
<div id="ctpbxfhgco" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>@import url("https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
#ctpbxfhgco table {
  font-family: Lato, system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#ctpbxfhgco thead, #ctpbxfhgco tbody, #ctpbxfhgco tfoot, #ctpbxfhgco tr, #ctpbxfhgco td, #ctpbxfhgco th {
  border-style: none;
}

#ctpbxfhgco p {
  margin: 0;
  padding: 0;
}

#ctpbxfhgco .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 3px;
  border-top-color: #FFFFFF;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#ctpbxfhgco .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#ctpbxfhgco .gt_title {
  color: #333333;
  font-size: 24px;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#ctpbxfhgco .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#ctpbxfhgco .gt_heading {
  background-color: #FFFFFF;
  text-align: left;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ctpbxfhgco .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ctpbxfhgco .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ctpbxfhgco .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#ctpbxfhgco .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#ctpbxfhgco .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#ctpbxfhgco .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#ctpbxfhgco .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#ctpbxfhgco .gt_spanner_row {
  border-bottom-style: hidden;
}

#ctpbxfhgco .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#ctpbxfhgco .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#ctpbxfhgco .gt_from_md > :first-child {
  margin-top: 0;
}

#ctpbxfhgco .gt_from_md > :last-child {
  margin-bottom: 0;
}

#ctpbxfhgco .gt_row {
  padding-top: 7px;
  padding-bottom: 7px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #F6F7F7;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#ctpbxfhgco .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#ctpbxfhgco .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#ctpbxfhgco .gt_row_group_first td {
  border-top-width: 2px;
}

#ctpbxfhgco .gt_row_group_first th {
  border-top-width: 2px;
}

#ctpbxfhgco .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ctpbxfhgco .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#ctpbxfhgco .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#ctpbxfhgco .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ctpbxfhgco .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ctpbxfhgco .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#ctpbxfhgco .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#ctpbxfhgco .gt_striped {
  background-color: #FAFAFA;
}

#ctpbxfhgco .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ctpbxfhgco .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ctpbxfhgco .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ctpbxfhgco .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ctpbxfhgco .gt_sourcenote {
  font-size: 12px;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ctpbxfhgco .gt_left {
  text-align: left;
}

#ctpbxfhgco .gt_center {
  text-align: center;
}

#ctpbxfhgco .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#ctpbxfhgco .gt_font_normal {
  font-weight: normal;
}

#ctpbxfhgco .gt_font_bold {
  font-weight: bold;
}

#ctpbxfhgco .gt_font_italic {
  font-style: italic;
}

#ctpbxfhgco .gt_super {
  font-size: 65%;
}

#ctpbxfhgco .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#ctpbxfhgco .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#ctpbxfhgco .gt_indent_1 {
  text-indent: 5px;
}

#ctpbxfhgco .gt_indent_2 {
  text-indent: 10px;
}

#ctpbxfhgco .gt_indent_3 {
  text-indent: 15px;
}

#ctpbxfhgco .gt_indent_4 {
  text-indent: 20px;
}

#ctpbxfhgco .gt_indent_5 {
  text-indent: 25px;
}

#ctpbxfhgco .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#ctpbxfhgco div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_col_headings">
<th id="ATE" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">ATE</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_right" headers="ATE">2458</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="matching-estimator-5" class="slide level2">
<h2>Matching estimator</h2>
<p>This is a contrived example, just to introduce matching.</p>
<p>In reality, we usually have more than one feature and units don’t match perfectly. In this case, we have to define some measurement of proximity to compare how units are close to each other. One common metric for this is the euclidean norm <span class="math inline">\(||X_i - X_j||\)</span>. This difference, however, is not invariant to the scale of the features. This means that features like age, that take values on the tenths, will be much less important when computing this norm compared to features like income, which take the order of hundreds.</p>
<p>For this reason, before applying the norm, we need to scale the features so that they are on roughly the same scale.</p>
</section>
<section id="matching-estimator-6" class="slide level2">
<h2>Matching estimator</h2>
<p>Having defined a distance measure, we can now define the match as the nearest neighbour to that sample we wish to match. In math terms, we can write the matching estimator the following way</p>
<p><span class="math display">\[
\hat{ATE} = \frac{1}{N} \sum^N_{i=1} (2D_i - 1)\big(Y_i - Y_{jm}(i)\big)
\]</span></p>
<p>Where <span class="math inline">\(Y_{jm}(i)\)</span> is the sample from the other treatment group which is most similar to <span class="math inline">\(Y_i\)</span>. We do this <span class="math inline">\(2T_i - 1\)</span> to match both ways: treated with controls and controls with the treatment.</p>
</section>
<section id="matching-estimator-7" class="slide level2">
<h2>Matching estimator</h2>
<p>To test this estimator, let’s consider a medicine example. Once again, we want to find the effect of a medication on days until recovery. Unfortunately, this effect is confounded by severity, sex and age. We have reasons to believe that patients with more severe conditions have a higher chance of receiving the medicine.</p>
<div class="cell">
<div class="cell-output-display">
<div id="pvpgmxiuch" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>@import url("https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
#pvpgmxiuch table {
  font-family: Lato, system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#pvpgmxiuch thead, #pvpgmxiuch tbody, #pvpgmxiuch tfoot, #pvpgmxiuch tr, #pvpgmxiuch td, #pvpgmxiuch th {
  border-style: none;
}

#pvpgmxiuch p {
  margin: 0;
  padding: 0;
}

#pvpgmxiuch .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 3px;
  border-top-color: #FFFFFF;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#pvpgmxiuch .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#pvpgmxiuch .gt_title {
  color: #333333;
  font-size: 24px;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#pvpgmxiuch .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#pvpgmxiuch .gt_heading {
  background-color: #FFFFFF;
  text-align: left;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#pvpgmxiuch .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#pvpgmxiuch .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#pvpgmxiuch .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#pvpgmxiuch .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#pvpgmxiuch .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#pvpgmxiuch .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#pvpgmxiuch .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#pvpgmxiuch .gt_spanner_row {
  border-bottom-style: hidden;
}

#pvpgmxiuch .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#pvpgmxiuch .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#pvpgmxiuch .gt_from_md > :first-child {
  margin-top: 0;
}

#pvpgmxiuch .gt_from_md > :last-child {
  margin-bottom: 0;
}

#pvpgmxiuch .gt_row {
  padding-top: 7px;
  padding-bottom: 7px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #F6F7F7;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#pvpgmxiuch .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#pvpgmxiuch .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#pvpgmxiuch .gt_row_group_first td {
  border-top-width: 2px;
}

#pvpgmxiuch .gt_row_group_first th {
  border-top-width: 2px;
}

#pvpgmxiuch .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#pvpgmxiuch .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#pvpgmxiuch .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#pvpgmxiuch .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#pvpgmxiuch .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#pvpgmxiuch .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#pvpgmxiuch .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#pvpgmxiuch .gt_striped {
  background-color: #FAFAFA;
}

#pvpgmxiuch .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#pvpgmxiuch .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#pvpgmxiuch .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#pvpgmxiuch .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#pvpgmxiuch .gt_sourcenote {
  font-size: 12px;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#pvpgmxiuch .gt_left {
  text-align: left;
}

#pvpgmxiuch .gt_center {
  text-align: center;
}

#pvpgmxiuch .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#pvpgmxiuch .gt_font_normal {
  font-weight: normal;
}

#pvpgmxiuch .gt_font_bold {
  font-weight: bold;
}

#pvpgmxiuch .gt_font_italic {
  font-style: italic;
}

#pvpgmxiuch .gt_super {
  font-size: 65%;
}

#pvpgmxiuch .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#pvpgmxiuch .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#pvpgmxiuch .gt_indent_1 {
  text-indent: 5px;
}

#pvpgmxiuch .gt_indent_2 {
  text-indent: 10px;
}

#pvpgmxiuch .gt_indent_3 {
  text-indent: 15px;
}

#pvpgmxiuch .gt_indent_4 {
  text-indent: 20px;
}

#pvpgmxiuch .gt_indent_5 {
  text-indent: 25px;
}

#pvpgmxiuch .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#pvpgmxiuch div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_col_headings">
<th id="sex" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">sex</th>
<th id="age" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">age</th>
<th id="severity" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">severity</th>
<th id="medication" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">medication</th>
<th id="recovery" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">recovery</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_right" headers="sex">0</td>
<td class="gt_row gt_right" headers="age">35.05</td>
<td class="gt_row gt_right" headers="severity">0.8877</td>
<td class="gt_row gt_right" headers="medication">1</td>
<td class="gt_row gt_right" headers="recovery">31</td>
</tr>
<tr class="even">
<td class="gt_row gt_right gt_striped" headers="sex">1</td>
<td class="gt_row gt_right gt_striped" headers="age">41.58</td>
<td class="gt_row gt_right gt_striped" headers="severity">0.8998</td>
<td class="gt_row gt_right gt_striped" headers="medication">1</td>
<td class="gt_row gt_right gt_striped" headers="recovery">49</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="sex">1</td>
<td class="gt_row gt_right" headers="age">28.13</td>
<td class="gt_row gt_right" headers="severity">0.4863</td>
<td class="gt_row gt_right" headers="medication">0</td>
<td class="gt_row gt_right" headers="recovery">38</td>
</tr>
<tr class="even">
<td class="gt_row gt_right gt_striped" headers="sex">1</td>
<td class="gt_row gt_right gt_striped" headers="age">36.38</td>
<td class="gt_row gt_right gt_striped" headers="severity">0.3231</td>
<td class="gt_row gt_right gt_striped" headers="medication">0</td>
<td class="gt_row gt_right gt_striped" headers="recovery">35</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="sex">0</td>
<td class="gt_row gt_right" headers="age">25.09</td>
<td class="gt_row gt_right" headers="severity">0.2090</td>
<td class="gt_row gt_right" headers="medication">0</td>
<td class="gt_row gt_right" headers="recovery">15</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="matching-estimator-8" class="slide level2">
<h2>Matching estimator</h2>
<p>If we look at a simple difference in means, <span class="math inline">\(E[Y|D=1]-E[Y|D=0]\)</span>, we get that the treatment takes, on average, 16.9 more days to recover than the untreated. This is probably due to confounding, since we don’t expect the medicine to cause harm to the patient.</p>
<div class="cell">
<div class="cell-output-display">
<div id="lstobdjlbd" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>@import url("https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
#lstobdjlbd table {
  font-family: Lato, system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#lstobdjlbd thead, #lstobdjlbd tbody, #lstobdjlbd tfoot, #lstobdjlbd tr, #lstobdjlbd td, #lstobdjlbd th {
  border-style: none;
}

#lstobdjlbd p {
  margin: 0;
  padding: 0;
}

#lstobdjlbd .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 3px;
  border-top-color: #FFFFFF;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#lstobdjlbd .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#lstobdjlbd .gt_title {
  color: #333333;
  font-size: 24px;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#lstobdjlbd .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#lstobdjlbd .gt_heading {
  background-color: #FFFFFF;
  text-align: left;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#lstobdjlbd .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#lstobdjlbd .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#lstobdjlbd .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#lstobdjlbd .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#lstobdjlbd .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#lstobdjlbd .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#lstobdjlbd .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#lstobdjlbd .gt_spanner_row {
  border-bottom-style: hidden;
}

#lstobdjlbd .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#lstobdjlbd .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#lstobdjlbd .gt_from_md > :first-child {
  margin-top: 0;
}

#lstobdjlbd .gt_from_md > :last-child {
  margin-bottom: 0;
}

#lstobdjlbd .gt_row {
  padding-top: 7px;
  padding-bottom: 7px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #F6F7F7;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#lstobdjlbd .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#lstobdjlbd .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#lstobdjlbd .gt_row_group_first td {
  border-top-width: 2px;
}

#lstobdjlbd .gt_row_group_first th {
  border-top-width: 2px;
}

#lstobdjlbd .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#lstobdjlbd .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#lstobdjlbd .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#lstobdjlbd .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#lstobdjlbd .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#lstobdjlbd .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#lstobdjlbd .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#lstobdjlbd .gt_striped {
  background-color: #FAFAFA;
}

#lstobdjlbd .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#lstobdjlbd .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#lstobdjlbd .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#lstobdjlbd .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#lstobdjlbd .gt_sourcenote {
  font-size: 12px;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#lstobdjlbd .gt_left {
  text-align: left;
}

#lstobdjlbd .gt_center {
  text-align: center;
}

#lstobdjlbd .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#lstobdjlbd .gt_font_normal {
  font-weight: normal;
}

#lstobdjlbd .gt_font_bold {
  font-weight: bold;
}

#lstobdjlbd .gt_font_italic {
  font-style: italic;
}

#lstobdjlbd .gt_super {
  font-size: 65%;
}

#lstobdjlbd .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#lstobdjlbd .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#lstobdjlbd .gt_indent_1 {
  text-indent: 5px;
}

#lstobdjlbd .gt_indent_2 {
  text-indent: 10px;
}

#lstobdjlbd .gt_indent_3 {
  text-indent: 15px;
}

#lstobdjlbd .gt_indent_4 {
  text-indent: 20px;
}

#lstobdjlbd .gt_indent_5 {
  text-indent: 25px;
}

#lstobdjlbd .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#lstobdjlbd div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_col_headings">
<th id="medication" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">medication</th>
<th id="mean_effect" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">mean_effect</th>
<th id="ATE" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">ATE</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_right" headers="medication">0</td>
<td class="gt_row gt_right" headers="mean_effect">21.68</td>
<td class="gt_row gt_right" headers="ATE">NA</td>
</tr>
<tr class="even">
<td class="gt_row gt_right gt_striped" headers="medication">1</td>
<td class="gt_row gt_right gt_striped" headers="mean_effect">38.57</td>
<td class="gt_row gt_right gt_striped" headers="ATE">16.9</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="matching-estimator-9" class="slide level2">
<h2>Matching estimator</h2>
<p>To correct for this bias, we will control for X using matching. First, we need to remember to scale our features, otherwise, features like age will have higher importance than features like severity when we compute the distance between points. To do so, we can standardise the features.</p>
<div class="cell">
<div class="cell-output-display">
<div id="ghjtqmoerj" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>@import url("https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
#ghjtqmoerj table {
  font-family: Lato, system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#ghjtqmoerj thead, #ghjtqmoerj tbody, #ghjtqmoerj tfoot, #ghjtqmoerj tr, #ghjtqmoerj td, #ghjtqmoerj th {
  border-style: none;
}

#ghjtqmoerj p {
  margin: 0;
  padding: 0;
}

#ghjtqmoerj .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 3px;
  border-top-color: #FFFFFF;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#ghjtqmoerj .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#ghjtqmoerj .gt_title {
  color: #333333;
  font-size: 24px;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#ghjtqmoerj .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#ghjtqmoerj .gt_heading {
  background-color: #FFFFFF;
  text-align: left;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ghjtqmoerj .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ghjtqmoerj .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ghjtqmoerj .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#ghjtqmoerj .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#ghjtqmoerj .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#ghjtqmoerj .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#ghjtqmoerj .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#ghjtqmoerj .gt_spanner_row {
  border-bottom-style: hidden;
}

#ghjtqmoerj .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#ghjtqmoerj .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#ghjtqmoerj .gt_from_md > :first-child {
  margin-top: 0;
}

#ghjtqmoerj .gt_from_md > :last-child {
  margin-bottom: 0;
}

#ghjtqmoerj .gt_row {
  padding-top: 7px;
  padding-bottom: 7px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #F6F7F7;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#ghjtqmoerj .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#ghjtqmoerj .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#ghjtqmoerj .gt_row_group_first td {
  border-top-width: 2px;
}

#ghjtqmoerj .gt_row_group_first th {
  border-top-width: 2px;
}

#ghjtqmoerj .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ghjtqmoerj .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#ghjtqmoerj .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#ghjtqmoerj .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ghjtqmoerj .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ghjtqmoerj .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#ghjtqmoerj .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#ghjtqmoerj .gt_striped {
  background-color: #FAFAFA;
}

#ghjtqmoerj .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ghjtqmoerj .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ghjtqmoerj .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ghjtqmoerj .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ghjtqmoerj .gt_sourcenote {
  font-size: 12px;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ghjtqmoerj .gt_left {
  text-align: left;
}

#ghjtqmoerj .gt_center {
  text-align: center;
}

#ghjtqmoerj .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#ghjtqmoerj .gt_font_normal {
  font-weight: normal;
}

#ghjtqmoerj .gt_font_bold {
  font-weight: bold;
}

#ghjtqmoerj .gt_font_italic {
  font-style: italic;
}

#ghjtqmoerj .gt_super {
  font-size: 65%;
}

#ghjtqmoerj .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#ghjtqmoerj .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#ghjtqmoerj .gt_indent_1 {
  text-indent: 5px;
}

#ghjtqmoerj .gt_indent_2 {
  text-indent: 10px;
}

#ghjtqmoerj .gt_indent_3 {
  text-indent: 15px;
}

#ghjtqmoerj .gt_indent_4 {
  text-indent: 20px;
}

#ghjtqmoerj .gt_indent_5 {
  text-indent: 25px;
}

#ghjtqmoerj .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#ghjtqmoerj div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_col_headings">
<th id="sex" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">sex</th>
<th id="age" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">age</th>
<th id="severity" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">severity</th>
<th id="medication" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">medication</th>
<th id="recovery" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">recovery</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_right" headers="sex">-0.997</td>
<td class="gt_row gt_right" headers="age">0.2808</td>
<td class="gt_row gt_right" headers="severity">1.4598</td>
<td class="gt_row gt_right" headers="medication">1</td>
<td class="gt_row gt_right" headers="recovery">31</td>
</tr>
<tr class="even">
<td class="gt_row gt_right gt_striped" headers="sex">1.003</td>
<td class="gt_row gt_right gt_striped" headers="age">0.8654</td>
<td class="gt_row gt_right gt_striped" headers="severity">1.5022</td>
<td class="gt_row gt_right gt_striped" headers="medication">1</td>
<td class="gt_row gt_right gt_striped" headers="recovery">49</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="sex">1.003</td>
<td class="gt_row gt_right" headers="age">-0.3387</td>
<td class="gt_row gt_right" headers="severity">0.0578</td>
<td class="gt_row gt_right" headers="medication">0</td>
<td class="gt_row gt_right" headers="recovery">38</td>
</tr>
<tr class="even">
<td class="gt_row gt_right gt_striped" headers="sex">1.003</td>
<td class="gt_row gt_right gt_striped" headers="age">0.3995</td>
<td class="gt_row gt_right gt_striped" headers="severity">-0.5126</td>
<td class="gt_row gt_right gt_striped" headers="medication">0</td>
<td class="gt_row gt_right gt_striped" headers="recovery">35</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="sex">-0.997</td>
<td class="gt_row gt_right" headers="age">-0.6105</td>
<td class="gt_row gt_right" headers="severity">-0.9111</td>
<td class="gt_row gt_right" headers="medication">0</td>
<td class="gt_row gt_right" headers="recovery">15</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="matching-estimator-10" class="slide level2">
<h2>Matching estimator</h2>
<p>Now, to the matching itself. Instead of coding a matching function, we will use the K nearest neighbour algorithm from <code>caret::knnreg</code>. This algorithm makes predictions by finding the nearest data point in an estimation or training set.</p>
<p>For matching, we will need 2 of those. One, mt0, will store the untreated points and will find matches in the untreated when asked to do so. The other, mt1, will store the treated point and will find matches in the treated when asked to do so. After this fitting step, we can use these KNN models to make predictions, which will be our matches.</p>
</section>
<section id="matching-estimator-11" class="slide level2">
<h2>Matching estimator</h2>
<div class="cell">
<div class="cell-output-display">
<div id="gubvmaftha" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>@import url("https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
#gubvmaftha table {
  font-family: Lato, system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#gubvmaftha thead, #gubvmaftha tbody, #gubvmaftha tfoot, #gubvmaftha tr, #gubvmaftha td, #gubvmaftha th {
  border-style: none;
}

#gubvmaftha p {
  margin: 0;
  padding: 0;
}

#gubvmaftha .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 3px;
  border-top-color: #FFFFFF;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#gubvmaftha .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#gubvmaftha .gt_title {
  color: #333333;
  font-size: 24px;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#gubvmaftha .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#gubvmaftha .gt_heading {
  background-color: #FFFFFF;
  text-align: left;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#gubvmaftha .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#gubvmaftha .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#gubvmaftha .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#gubvmaftha .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#gubvmaftha .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#gubvmaftha .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#gubvmaftha .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#gubvmaftha .gt_spanner_row {
  border-bottom-style: hidden;
}

#gubvmaftha .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#gubvmaftha .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#gubvmaftha .gt_from_md > :first-child {
  margin-top: 0;
}

#gubvmaftha .gt_from_md > :last-child {
  margin-bottom: 0;
}

#gubvmaftha .gt_row {
  padding-top: 7px;
  padding-bottom: 7px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #F6F7F7;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#gubvmaftha .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#gubvmaftha .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#gubvmaftha .gt_row_group_first td {
  border-top-width: 2px;
}

#gubvmaftha .gt_row_group_first th {
  border-top-width: 2px;
}

#gubvmaftha .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#gubvmaftha .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#gubvmaftha .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#gubvmaftha .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#gubvmaftha .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#gubvmaftha .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#gubvmaftha .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#gubvmaftha .gt_striped {
  background-color: #FAFAFA;
}

#gubvmaftha .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#gubvmaftha .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#gubvmaftha .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#gubvmaftha .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#gubvmaftha .gt_sourcenote {
  font-size: 12px;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#gubvmaftha .gt_left {
  text-align: left;
}

#gubvmaftha .gt_center {
  text-align: center;
}

#gubvmaftha .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#gubvmaftha .gt_font_normal {
  font-weight: normal;
}

#gubvmaftha .gt_font_bold {
  font-weight: bold;
}

#gubvmaftha .gt_font_italic {
  font-style: italic;
}

#gubvmaftha .gt_super {
  font-size: 65%;
}

#gubvmaftha .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#gubvmaftha .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#gubvmaftha .gt_indent_1 {
  text-indent: 5px;
}

#gubvmaftha .gt_indent_2 {
  text-indent: 10px;
}

#gubvmaftha .gt_indent_3 {
  text-indent: 15px;
}

#gubvmaftha .gt_indent_4 {
  text-indent: 20px;
}

#gubvmaftha .gt_indent_5 {
  text-indent: 25px;
}

#gubvmaftha .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#gubvmaftha div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_col_headings">
<th id="ID" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">ID</th>
<th id="sex" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">sex</th>
<th id="age" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">age</th>
<th id="severity" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">severity</th>
<th id="medication" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">medication</th>
<th id="recovery" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">recovery</th>
<th id="match" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">match</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_right" headers="ID">1</td>
<td class="gt_row gt_right" headers="sex">−0.996980</td>
<td class="gt_row gt_right" headers="age">0.280787</td>
<td class="gt_row gt_right" headers="severity">1.459800</td>
<td class="gt_row gt_right" headers="medication">1</td>
<td class="gt_row gt_right" headers="recovery">31</td>
<td class="gt_row gt_right" headers="match">39</td>
</tr>
<tr class="even">
<td class="gt_row gt_right gt_striped" headers="ID">2</td>
<td class="gt_row gt_right gt_striped" headers="sex">1.002979</td>
<td class="gt_row gt_right gt_striped" headers="age">0.865375</td>
<td class="gt_row gt_right gt_striped" headers="severity">1.502164</td>
<td class="gt_row gt_right gt_striped" headers="medication">1</td>
<td class="gt_row gt_right gt_striped" headers="recovery">49</td>
<td class="gt_row gt_right gt_striped" headers="match">52</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="ID">3</td>
<td class="gt_row gt_right" headers="sex">−0.996980</td>
<td class="gt_row gt_right" headers="age">1.495134</td>
<td class="gt_row gt_right" headers="severity">1.268540</td>
<td class="gt_row gt_right" headers="medication">1</td>
<td class="gt_row gt_right" headers="recovery">38</td>
<td class="gt_row gt_right" headers="match">46</td>
</tr>
<tr class="even">
<td class="gt_row gt_right gt_striped" headers="ID">4</td>
<td class="gt_row gt_right gt_striped" headers="sex">1.002979</td>
<td class="gt_row gt_right gt_striped" headers="age">−0.106534</td>
<td class="gt_row gt_right gt_striped" headers="severity">0.545911</td>
<td class="gt_row gt_right gt_striped" headers="medication">1</td>
<td class="gt_row gt_right gt_striped" headers="recovery">34</td>
<td class="gt_row gt_right gt_striped" headers="match">45</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="ID">5</td>
<td class="gt_row gt_right" headers="sex">−0.996980</td>
<td class="gt_row gt_right" headers="age">0.043034</td>
<td class="gt_row gt_right" headers="severity">1.428732</td>
<td class="gt_row gt_right" headers="medication">1</td>
<td class="gt_row gt_right" headers="recovery">30</td>
<td class="gt_row gt_right" headers="match">39</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="matching-estimator-12" class="slide level2">
<h2>Matching estimator</h2>
<p>With the matches, we can now apply the matching estimator formula</p>
<p><span class="math display">\[
\hat{ATE} = \frac{1}{N} \sum^N_{i=1} (2D_i - 1)\big(Y_i - Y_{jm}(i)\big)
\]</span></p>
<div class="cell">
<div class="cell-output-display">
<div id="hxdcaqcbfy" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>@import url("https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
#hxdcaqcbfy table {
  font-family: Lato, system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#hxdcaqcbfy thead, #hxdcaqcbfy tbody, #hxdcaqcbfy tfoot, #hxdcaqcbfy tr, #hxdcaqcbfy td, #hxdcaqcbfy th {
  border-style: none;
}

#hxdcaqcbfy p {
  margin: 0;
  padding: 0;
}

#hxdcaqcbfy .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 3px;
  border-top-color: #FFFFFF;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#hxdcaqcbfy .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#hxdcaqcbfy .gt_title {
  color: #333333;
  font-size: 24px;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#hxdcaqcbfy .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#hxdcaqcbfy .gt_heading {
  background-color: #FFFFFF;
  text-align: left;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#hxdcaqcbfy .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hxdcaqcbfy .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#hxdcaqcbfy .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#hxdcaqcbfy .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#hxdcaqcbfy .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#hxdcaqcbfy .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#hxdcaqcbfy .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#hxdcaqcbfy .gt_spanner_row {
  border-bottom-style: hidden;
}

#hxdcaqcbfy .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#hxdcaqcbfy .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#hxdcaqcbfy .gt_from_md > :first-child {
  margin-top: 0;
}

#hxdcaqcbfy .gt_from_md > :last-child {
  margin-bottom: 0;
}

#hxdcaqcbfy .gt_row {
  padding-top: 7px;
  padding-bottom: 7px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #F6F7F7;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#hxdcaqcbfy .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#hxdcaqcbfy .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#hxdcaqcbfy .gt_row_group_first td {
  border-top-width: 2px;
}

#hxdcaqcbfy .gt_row_group_first th {
  border-top-width: 2px;
}

#hxdcaqcbfy .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#hxdcaqcbfy .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#hxdcaqcbfy .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#hxdcaqcbfy .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hxdcaqcbfy .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#hxdcaqcbfy .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#hxdcaqcbfy .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#hxdcaqcbfy .gt_striped {
  background-color: #FAFAFA;
}

#hxdcaqcbfy .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hxdcaqcbfy .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#hxdcaqcbfy .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#hxdcaqcbfy .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#hxdcaqcbfy .gt_sourcenote {
  font-size: 12px;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#hxdcaqcbfy .gt_left {
  text-align: left;
}

#hxdcaqcbfy .gt_center {
  text-align: center;
}

#hxdcaqcbfy .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#hxdcaqcbfy .gt_font_normal {
  font-weight: normal;
}

#hxdcaqcbfy .gt_font_bold {
  font-weight: bold;
}

#hxdcaqcbfy .gt_font_italic {
  font-style: italic;
}

#hxdcaqcbfy .gt_super {
  font-size: 65%;
}

#hxdcaqcbfy .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#hxdcaqcbfy .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#hxdcaqcbfy .gt_indent_1 {
  text-indent: 5px;
}

#hxdcaqcbfy .gt_indent_2 {
  text-indent: 10px;
}

#hxdcaqcbfy .gt_indent_3 {
  text-indent: 15px;
}

#hxdcaqcbfy .gt_indent_4 {
  text-indent: 20px;
}

#hxdcaqcbfy .gt_indent_5 {
  text-indent: 25px;
}

#hxdcaqcbfy .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#hxdcaqcbfy div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_col_headings">
<th id="ATE (est)" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">ATE (est)</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_right" headers="ATE (est)">-0.9954</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Using this sort of matching, we can see that the effect of the medicine is not positive anymore. This means that, controlling for <span class="math inline">\(X\)</span>, the medicine reduces the recovery time by about 1 day, on average. This is already a huge improvement on top of the biased estimate that predicted a 16.9 increase in recovery time.</p>
</section>
<section id="matching-bias" class="slide level2">
<h2>Matching bias</h2>
<p>It turns out the matching estimator as we’ve designed above is biased. To see this, let’s consider the ATET estimator, instead of the ATE, just because it is simpler to write. The intuition will apply to the ATE as well.</p>
<p><span class="math display">\[
\hat{ATET} = \frac{1}{N_1}\sum (Y_i - Y_j(i))
\]</span> where <span class="math inline">\(N_1\)</span> is the number of treated individuals and <span class="math inline">\(Y_j(i)\)</span> is the untreated match of treated unit i.</p>
</section>
<section id="matching-bias-1" class="slide level2">
<h2>Matching bias</h2>
<p>To check for bias, what we do is hope we can apply the Central Limit Theorem so that this estimate converges to a normal distribution with mean zero.</p>
<p><span class="math display">\[
\sqrt{N_1}(\hat{ATET} - ATET)
\]</span>However, this doesn’t alway happen. If we define the mean outcome for the untreated given X, <span class="math inline">\(\mu_0(x)=E[Y|X=x, D=0]\)</span>, we will have that (btw, I’ve omitted the proof for that because it’s a little beyond the point here).</p>
<p><span class="math display">\[
E[\sqrt{N_1}(\hat{ATET} - ATET)] = E[\sqrt{N_1}(\mu_0(X_i) - \mu_0(X_j(i)))]
\]</span></p>
</section>
<section id="matching-bias-2" class="slide level2">
<h2>Matching bias</h2>
<p>Now, <span class="math inline">\(\mu_0(X_i) - \mu_0(X_j(i))\)</span> is not so simple to understand, so let’s look at it more carefully. <span class="math inline">\(\mu_0(X_i)\)</span> is the outcome Y value of a treated unit <span class="math inline">\(i\)</span> had it not been treated. So, it is the counterfactual outcome <span class="math inline">\(Y^0\)</span> for unit <span class="math inline">\(i\)</span>. <span class="math inline">\(\mu_0(X_j(i))\)</span> is the outcome of the untreated unit <span class="math inline">\(j\)</span> that is the match of unit <span class="math inline">\(i\)</span>. So, it is also the <span class="math inline">\(Y^0\)</span>, but for unit <span class="math inline">\(j\)</span> now. Only this time, it is a factual outcome, because <span class="math inline">\(j\)</span> is in the non treated group. Now, because <span class="math inline">\(j\)</span> and <span class="math inline">\(i\)</span> are only similar, but not the same, this will likely not be zero. In other words, <span class="math inline">\(X_i \approx X_j\)</span>. So, <span class="math inline">\(Y^0_i \approx Y^0_j\)</span>.</p>
</section>
<section id="matching-bias-3" class="slide level2">
<h2>Matching bias</h2>
<p>As we increase the sample size, there will be more units to match, so the difference between unit <span class="math inline">\(i\)</span> and its match <span class="math inline">\(j\)</span> will also get smaller. But this difference converges to zero slowly. As a result <span class="math inline">\(E[\sqrt{N_1}(\mu_0(X_i) - \mu_0(X_j(i)))]\)</span> may not converge to zero, because the <span class="math inline">\(\sqrt{N_1}\)</span> grows faster than <span class="math inline">\((\mu_0(X_i) - \mu_0(X_j(i)))\)</span> diminishes.</p>
</section>
<section id="matching-bias-4" class="slide level2">
<h2>Matching bias</h2>
<p>Bias arises when the matching discrepancies are huge. Fortunately, we know how to correct it. Each observation contributes <span class="math inline">\((\mu_0(X_i) - \mu_0(X_j(i)))\)</span> to the bias so all we need to do is subtract this quantity from each matching comparison in our estimator. To do so, we can replace <span class="math inline">\(\mu_0(X_j(i))\)</span> with some sort of estimate of this quantity <span class="math inline">\(\hat{\mu}_0(X_j(i))\)</span>, which can be obtained with models like linear regression. This updates the ATET estimator to the following equation:</p>
<p><span class="math display">\[
\hat{ATET} = \frac{1}{N_1}\sum \big((Y_i - Y_{j(i)}) - (\hat{\mu_0}(X_i) - \hat{\mu_0}(X_{j(i)}))\big)
\]</span> where <span class="math inline">\(\hat{\mu_0}(x)\)</span> is some estimative of <span class="math inline">\(E[Y|X, D=0]\)</span>, like a linear regression fitted only on the untreated sample.</p>
</section>
<section id="matching-bias-5" class="slide level2">
<h2>Matching bias</h2>
<div class="cell">
<div class="cell-output-display">
<div id="hszyereimh" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>@import url("https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
#hszyereimh table {
  font-family: Lato, system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#hszyereimh thead, #hszyereimh tbody, #hszyereimh tfoot, #hszyereimh tr, #hszyereimh td, #hszyereimh th {
  border-style: none;
}

#hszyereimh p {
  margin: 0;
  padding: 0;
}

#hszyereimh .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 3px;
  border-top-color: #FFFFFF;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#hszyereimh .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#hszyereimh .gt_title {
  color: #333333;
  font-size: 24px;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#hszyereimh .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#hszyereimh .gt_heading {
  background-color: #FFFFFF;
  text-align: left;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#hszyereimh .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hszyereimh .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#hszyereimh .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#hszyereimh .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#hszyereimh .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#hszyereimh .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#hszyereimh .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#hszyereimh .gt_spanner_row {
  border-bottom-style: hidden;
}

#hszyereimh .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#hszyereimh .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#hszyereimh .gt_from_md > :first-child {
  margin-top: 0;
}

#hszyereimh .gt_from_md > :last-child {
  margin-bottom: 0;
}

#hszyereimh .gt_row {
  padding-top: 7px;
  padding-bottom: 7px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #F6F7F7;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#hszyereimh .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#hszyereimh .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#hszyereimh .gt_row_group_first td {
  border-top-width: 2px;
}

#hszyereimh .gt_row_group_first th {
  border-top-width: 2px;
}

#hszyereimh .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#hszyereimh .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#hszyereimh .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#hszyereimh .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hszyereimh .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#hszyereimh .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#hszyereimh .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#hszyereimh .gt_striped {
  background-color: #FAFAFA;
}

#hszyereimh .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hszyereimh .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#hszyereimh .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#hszyereimh .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#hszyereimh .gt_sourcenote {
  font-size: 12px;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#hszyereimh .gt_left {
  text-align: left;
}

#hszyereimh .gt_center {
  text-align: center;
}

#hszyereimh .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#hszyereimh .gt_font_normal {
  font-weight: normal;
}

#hszyereimh .gt_font_bold {
  font-weight: bold;
}

#hszyereimh .gt_font_italic {
  font-style: italic;
}

#hszyereimh .gt_super {
  font-size: 65%;
}

#hszyereimh .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#hszyereimh .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#hszyereimh .gt_indent_1 {
  text-indent: 5px;
}

#hszyereimh .gt_indent_2 {
  text-indent: 10px;
}

#hszyereimh .gt_indent_3 {
  text-indent: 15px;
}

#hszyereimh .gt_indent_4 {
  text-indent: 20px;
}

#hszyereimh .gt_indent_5 {
  text-indent: 25px;
}

#hszyereimh .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#hszyereimh div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_col_headings">
<th id="ID" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">ID</th>
<th id="sex" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">sex</th>
<th id="age" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">age</th>
<th id="severity" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">severity</th>
<th id="medication" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">medication</th>
<th id="recovery" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">recovery</th>
<th id="match" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">match</th>
<th id="bias_correct" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">bias_correct</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_right" headers="ID">1</td>
<td class="gt_row gt_right" headers="sex">−0.996980</td>
<td class="gt_row gt_right" headers="age">0.280787</td>
<td class="gt_row gt_right" headers="severity">1.459800</td>
<td class="gt_row gt_right" headers="medication">1</td>
<td class="gt_row gt_right" headers="recovery">31</td>
<td class="gt_row gt_right" headers="match">39</td>
<td class="gt_row gt_right" headers="bias_correct">4.404</td>
</tr>
<tr class="even">
<td class="gt_row gt_right gt_striped" headers="ID">2</td>
<td class="gt_row gt_right gt_striped" headers="sex">1.002979</td>
<td class="gt_row gt_right gt_striped" headers="age">0.865375</td>
<td class="gt_row gt_right gt_striped" headers="severity">1.502164</td>
<td class="gt_row gt_right gt_striped" headers="medication">1</td>
<td class="gt_row gt_right gt_striped" headers="recovery">49</td>
<td class="gt_row gt_right gt_striped" headers="match">52</td>
<td class="gt_row gt_right gt_striped" headers="bias_correct">12.915</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="ID">3</td>
<td class="gt_row gt_right" headers="sex">−0.996980</td>
<td class="gt_row gt_right" headers="age">1.495134</td>
<td class="gt_row gt_right" headers="severity">1.268540</td>
<td class="gt_row gt_right" headers="medication">1</td>
<td class="gt_row gt_right" headers="recovery">38</td>
<td class="gt_row gt_right" headers="match">46</td>
<td class="gt_row gt_right" headers="bias_correct">1.871</td>
</tr>
<tr class="even">
<td class="gt_row gt_right gt_striped" headers="ID">4</td>
<td class="gt_row gt_right gt_striped" headers="sex">1.002979</td>
<td class="gt_row gt_right gt_striped" headers="age">−0.106534</td>
<td class="gt_row gt_right gt_striped" headers="severity">0.545911</td>
<td class="gt_row gt_right gt_striped" headers="medication">1</td>
<td class="gt_row gt_right gt_striped" headers="recovery">34</td>
<td class="gt_row gt_right gt_striped" headers="match">45</td>
<td class="gt_row gt_right gt_striped" headers="bias_correct">-0.497</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="ID">5</td>
<td class="gt_row gt_right" headers="sex">−0.996980</td>
<td class="gt_row gt_right" headers="age">0.043034</td>
<td class="gt_row gt_right" headers="severity">1.428732</td>
<td class="gt_row gt_right" headers="medication">1</td>
<td class="gt_row gt_right" headers="recovery">30</td>
<td class="gt_row gt_right" headers="match">39</td>
<td class="gt_row gt_right" headers="bias_correct">2.610</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="matching-bias-6" class="slide level2">
<h2>Matching bias</h2>
<p>Doesn’t this defeat the point of matching? If I have to run a linear regression anyway, why don’t I use only that, instead of this complicated model.</p>
<p>First of all, this linear regression that we are fitting doesn’t extrapolate on the treatment dimension to get the treatment effect. Instead, its purpose is just to correct bias. Linear regression here is local, in the sense that it doesn’t try to see how the treated would be if it looked like the untreated. It does none of that extrapolation. This is left to the matching part. The meat of the estimator is still the matching component. The point is that OLS is secondary to this estimator.</p>
</section>
<section id="matching-bias-7" class="slide level2">
<h2>Matching bias</h2>
<p>The second point is that matching is a non-parametric estimator. It doesn’t assume linearity or any kind of parametric model. As such, it is more flexible than linear regression and can work in situations where linear regression will not, namely, those where non linearity is very strong.</p>
</section>
<section id="matching-bias-8" class="slide level2">
<h2>Matching bias</h2>
<p>With the bias correction formula, I get the following ATE estimation.</p>
<div class="cell">
<div class="cell-output-display">
<div id="meffhyyfjn" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>@import url("https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
#meffhyyfjn table {
  font-family: Lato, system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#meffhyyfjn thead, #meffhyyfjn tbody, #meffhyyfjn tfoot, #meffhyyfjn tr, #meffhyyfjn td, #meffhyyfjn th {
  border-style: none;
}

#meffhyyfjn p {
  margin: 0;
  padding: 0;
}

#meffhyyfjn .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 3px;
  border-top-color: #FFFFFF;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#meffhyyfjn .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#meffhyyfjn .gt_title {
  color: #333333;
  font-size: 24px;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#meffhyyfjn .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#meffhyyfjn .gt_heading {
  background-color: #FFFFFF;
  text-align: left;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#meffhyyfjn .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#meffhyyfjn .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#meffhyyfjn .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#meffhyyfjn .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#meffhyyfjn .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#meffhyyfjn .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#meffhyyfjn .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#meffhyyfjn .gt_spanner_row {
  border-bottom-style: hidden;
}

#meffhyyfjn .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#meffhyyfjn .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#meffhyyfjn .gt_from_md > :first-child {
  margin-top: 0;
}

#meffhyyfjn .gt_from_md > :last-child {
  margin-bottom: 0;
}

#meffhyyfjn .gt_row {
  padding-top: 7px;
  padding-bottom: 7px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #F6F7F7;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#meffhyyfjn .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#meffhyyfjn .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#meffhyyfjn .gt_row_group_first td {
  border-top-width: 2px;
}

#meffhyyfjn .gt_row_group_first th {
  border-top-width: 2px;
}

#meffhyyfjn .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#meffhyyfjn .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#meffhyyfjn .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#meffhyyfjn .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#meffhyyfjn .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#meffhyyfjn .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#meffhyyfjn .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#meffhyyfjn .gt_striped {
  background-color: #FAFAFA;
}

#meffhyyfjn .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#meffhyyfjn .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#meffhyyfjn .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#meffhyyfjn .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#meffhyyfjn .gt_sourcenote {
  font-size: 12px;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#meffhyyfjn .gt_left {
  text-align: left;
}

#meffhyyfjn .gt_center {
  text-align: center;
}

#meffhyyfjn .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#meffhyyfjn .gt_font_normal {
  font-weight: normal;
}

#meffhyyfjn .gt_font_bold {
  font-weight: bold;
}

#meffhyyfjn .gt_font_italic {
  font-style: italic;
}

#meffhyyfjn .gt_super {
  font-size: 65%;
}

#meffhyyfjn .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#meffhyyfjn .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#meffhyyfjn .gt_indent_1 {
  text-indent: 5px;
}

#meffhyyfjn .gt_indent_2 {
  text-indent: 10px;
}

#meffhyyfjn .gt_indent_3 {
  text-indent: 15px;
}

#meffhyyfjn .gt_indent_4 {
  text-indent: 20px;
}

#meffhyyfjn .gt_indent_5 {
  text-indent: 25px;
}

#meffhyyfjn .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#meffhyyfjn div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_col_headings">
<th id="ATE (est)" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">ATE (est)</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_right" headers="ATE (est)">-7.363</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="matching-ci" class="slide level2">
<h2>Matching CI</h2>
<p>Of course, we also need to place a confidence interval around this measurement.</p>
<p>In practice, we can simply use someone else’s code and just import a matching estimator. Here is one from the library Matching.</p>
<div class="cell">
<div class="cell-output-display">
<div id="iywmsjsjod" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>@import url("https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
#iywmsjsjod table {
  font-family: Lato, system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#iywmsjsjod thead, #iywmsjsjod tbody, #iywmsjsjod tfoot, #iywmsjsjod tr, #iywmsjsjod td, #iywmsjsjod th {
  border-style: none;
}

#iywmsjsjod p {
  margin: 0;
  padding: 0;
}

#iywmsjsjod .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 3px;
  border-top-color: #FFFFFF;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#iywmsjsjod .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#iywmsjsjod .gt_title {
  color: #333333;
  font-size: 24px;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#iywmsjsjod .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#iywmsjsjod .gt_heading {
  background-color: #FFFFFF;
  text-align: left;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#iywmsjsjod .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#iywmsjsjod .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#iywmsjsjod .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#iywmsjsjod .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#iywmsjsjod .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#iywmsjsjod .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#iywmsjsjod .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#iywmsjsjod .gt_spanner_row {
  border-bottom-style: hidden;
}

#iywmsjsjod .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#iywmsjsjod .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#iywmsjsjod .gt_from_md > :first-child {
  margin-top: 0;
}

#iywmsjsjod .gt_from_md > :last-child {
  margin-bottom: 0;
}

#iywmsjsjod .gt_row {
  padding-top: 7px;
  padding-bottom: 7px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #F6F7F7;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#iywmsjsjod .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#iywmsjsjod .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#iywmsjsjod .gt_row_group_first td {
  border-top-width: 2px;
}

#iywmsjsjod .gt_row_group_first th {
  border-top-width: 2px;
}

#iywmsjsjod .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#iywmsjsjod .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#iywmsjsjod .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#iywmsjsjod .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#iywmsjsjod .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#iywmsjsjod .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#iywmsjsjod .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#iywmsjsjod .gt_striped {
  background-color: #FAFAFA;
}

#iywmsjsjod .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#iywmsjsjod .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#iywmsjsjod .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#iywmsjsjod .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#iywmsjsjod .gt_sourcenote {
  font-size: 12px;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#iywmsjsjod .gt_left {
  text-align: left;
}

#iywmsjsjod .gt_center {
  text-align: center;
}

#iywmsjsjod .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#iywmsjsjod .gt_font_normal {
  font-weight: normal;
}

#iywmsjsjod .gt_font_bold {
  font-weight: bold;
}

#iywmsjsjod .gt_font_italic {
  font-style: italic;
}

#iywmsjsjod .gt_super {
  font-size: 65%;
}

#iywmsjsjod .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#iywmsjsjod .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#iywmsjsjod .gt_indent_1 {
  text-indent: 5px;
}

#iywmsjsjod .gt_indent_2 {
  text-indent: 10px;
}

#iywmsjsjod .gt_indent_3 {
  text-indent: 15px;
}

#iywmsjsjod .gt_indent_4 {
  text-indent: 20px;
}

#iywmsjsjod .gt_indent_5 {
  text-indent: 25px;
}

#iywmsjsjod .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#iywmsjsjod div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_heading">
<th colspan="3" class="gt_heading gt_title gt_font_normal">Treatment Effect Estimates: Matching</th>
</tr>
<tr class="odd gt_heading">
<th colspan="3" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border">using R package Matching</th>
</tr>
<tr class="header gt_col_headings">
<th id="measure" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">measure</th>
<th id="est" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">est</th>
<th id="se" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">se</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="measure">ATE</td>
<td class="gt_row gt_right" headers="est">−7.708</td>
<td class="gt_row gt_right" headers="se">0.962</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_striped" headers="measure">ATC</td>
<td class="gt_row gt_right gt_striped" headers="est">−6.664</td>
<td class="gt_row gt_right gt_striped" headers="se">1.644</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="measure">ATT</td>
<td class="gt_row gt_right" headers="est">−9.680</td>
<td class="gt_row gt_right" headers="se">0.123</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Finally, we can say with confidence that our medicine does indeed lower the time someone spends at the hospital. The ATE estimate is just a little bit lower than our algorithm, due to the difference in tie breaking of matches of knn implementation and the <code>Matching</code> R package.</p>
</section>
<section id="matching-bias-again" class="slide level2">
<h2>Matching bias again</h2>
<p>We saw that matching is biased when the unit and its match are not so similar. But what causes them to be so different?</p>
<p>As it turns out, the answer is quite simple and intuitive. It is easy to find people that match on a few characteristics, like sex. But if we add more characteristics, like age, income, city of birth and so on, it becomes harder and harder to find matches. In more general terms, the more features we have, the higher will be the distance between units and their matches.</p>
<p>This is not something that hurts only the matching estimator. It ties back to the subclassification estimator we saw earlier. In that contrived medicine example where with man and woman, it was quite easy to build the subclassification estimator. That was because we only had 2 cells: man and woman. But what would happen if we had more? Let’s say we have 2 continuous features like age and income and we manage to discretise them into 5 buckets each. This will give us 25 cells, or <span class="math inline">\(5^2\)</span>. And what if we had 10 covariates with 3 buckets each? Doesn’t seem like a lot right? Well, this would give us 59049 cells, or <span class="math inline">\(3^{10}\)</span>. It’s easy to see how this can blow out of proportion pretty quickly. This is a phenomena pervasive in all data science, which is called the <strong>The Curse of Dimensionality!!!</strong></p>
</section>
<section id="matching-bias-again-1" class="slide level2">
<h2>Matching bias again</h2>
<p>In the context of the subclassification estimator, the curse of dimensionality means that it will suffer if we have lots of features.</p>
<p>Lots of features imply multiple cells in X. If there are multiple cells, some of them will have very few data. Some of them might even have only treated or only control, so it won’t be possible to estimate the ATE there, which would break our estimator.</p>
<p>In the matching context, this means that the feature space will be very sparse and units will be very far from each other. This will increase the distance between matches and cause bias problems.</p>
</section>
<section id="matching-bias-again-2" class="slide level2">
<h2>Matching bias again</h2>
<p>As for linear regression, it actually handles this problem quite well.</p>
<p>What it does is project all the features X into a single one, the Y dimension. It then makes treatment and control comparison on that projection. So, in some way, linear regression performs some sort of dimensionality reduction to estimate the ATE. It’s quite elegant.</p>
</section>
<section id="more" class="slide level2">
<h2>More</h2>
<ul>
<li>Read <a href="https://chabefer.github.io/STCI/index.html">Statistical tools for causal inference</a></li>
<li>Read <a href="https://www.r-causal.org/">Causal inference in R</a></li>
</ul>
</section>
<section id="recap" class="slide level2">
<h2>Recap</h2>
<ul>
<li>We introduced the fundamental problems of inference and the biases of some intuitive estimators,</li>
<li>We developed a basic understanding of the tools used to state and then satisfy causality assumptions,</li>
<li>We looked at an example of how econometric methods recover treatment effects.</li>
</ul>

<div class="quarto-auto-generated-content">
<p><img src="images/logo.png" class="slide-logo"></p>
<div class="footer footer-default">
<p><a href="https://bsmm-8740-fall-2024.github.io/osb/">bsmm-8740-fall-2024.github.io/osb</a></p>
</div>
</div>
</section></section>
    </div>
  </div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="../site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="../site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="../site_libs/revealjs/plugin/multiplex/socket.io.js"></script>
  <script src="../site_libs/revealjs/plugin/multiplex/multiplex.js"></script>
  <script src="../site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="../site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="../site_libs/revealjs/plugin/search/search.js"></script>
  <script src="../site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="../site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true,"numbers":true},
'multiplex': {"secret":null,"id":"1019794033bce944","url":"https://reveal-multiplex.glitch.me/"},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'fade',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 5.0e-2,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    
    <script>
      // htmlwidgets need to know to resize themselves when slides are shown/hidden.
      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
      // slide changes (different for each slide format).
      (function () {
        // dispatch for htmlwidgets
        function fireSlideEnter() {
          const event = window.document.createEvent("Event");
          event.initEvent("slideenter", true, true);
          window.document.dispatchEvent(event);
        }

        function fireSlideChanged(previousSlide, currentSlide) {
          fireSlideEnter();

          // dispatch for shiny
          if (window.jQuery) {
            if (previousSlide) {
              window.jQuery(previousSlide).trigger("hidden");
            }
            if (currentSlide) {
              window.jQuery(currentSlide).trigger("shown");
            }
          }
        }

        // hookup for slidy
        if (window.w3c_slidy) {
          window.w3c_slidy.add_observer(function (slide_num) {
            // slide_num starts at position 1
            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
          });
        }

      })();
    </script>

    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const onCopySuccess = function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      }
      const getTextToCopy = function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
        text: getTextToCopy
      });
      clipboard.on('success', onCopySuccess);
      if (window.document.getElementById('quarto-embedded-source-code-modal')) {
        // For code content inside modals, clipBoardJS needs to be initialized with a container option
        // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
        const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
          text: getTextToCopy,
          container: window.document.getElementById('quarto-embedded-source-code-modal')
        });
        clipboardModal.on('success', onCopySuccess);
      }
        var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
        var mailtoRegex = new RegExp(/^mailto:/);
          var filterRegex = new RegExp("https:\/\/bsmm-8740-fall-2024\.github\.io\/osb\/");
        var isInternal = (href) => {
            return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
        }
        // Inspect non-navigation links and adorn them if external
     	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
        for (var i=0; i<links.length; i++) {
          const link = links[i];
          if (!isInternal(link.href)) {
            // undo the damage that might have been done by quarto-nav.js in the case of
            // links that we want to consider external
            if (link.dataset.originalHref !== undefined) {
              link.href = link.dataset.originalHref;
            }
          }
        }
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note) {
            return note.innerHTML;
          } else {
            return "";
          }
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>